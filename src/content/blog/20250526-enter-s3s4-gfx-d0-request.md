---
title: "When entering S3/S4, GFX receives D0 request "
meta_title: ""
description: ""
date: 2025-05-26T12:00:00Z
image: ""
categories: ["OS"]
author: "Nick Kuo"
tags: ["Windows"]
draft: false
---
What is the D0?

Set BP on our handler, and filter by cond BP for set power state

```cpp
12: kd> bl
     0 e Disable Clear  fffff802`7b359020     0001 (0001) dxgkrnl!DpiDispatchPower ".if(by(poi(@rdx+0x78+0x40))==0x16 AND by(poi(@rdx+0x78+0x40)+1)==0x2) {!devobj @rcx; .echo PowerType:;dt nt!_POWER_STATE_TYPE poi(@rdx+0x78+0x40)+0x08+0x08;.echo PowerState:; dt nt!_POWER_STATE poi(@rdx+0x78+0x40)+0x08+0x10} .else {gc}"
     1 e Disable Clear  fffff802`e939d550     0001 (0001) nt!PoRequestPowerIrp ".if(@rcx == ffff80857e81f030) {} .else {gc}"
```

Set BP on PoRequestPowerIrp, the RCX is GFX device object. Capture the following sequence.

## Analysis

I think it’s just sequence by usermode & dxgk power mgmt.

The sequence for hibernate looks like this:

1. Monitor is turned off by a power IRP. I guess is to turn off the monitor itself (Not checked the source).
2.  GFX receive D3. Probably due to a reference to PoFx being released, or it’s a force D3 command (Not checked the source).
3.  LogonUI needs to cleanup, so dxgkrnl wakes up adapter, cleanup, and PoFx put it back to sleep when done.
4. Dxgk calls SuspendAdapter, this in turn calls Win32k PowerOffGdi. 
According to our previous discussion on PowerOnGdi, this is likely for userland GDI application to process. However, it attempts to hide the cursor, this wakes up GFX.
At the end of SuspendAdapter it queues FinishSuspendAdapter to DxgkPowerArbiter, in it, GFX is put back to D3.
5. Explorer uses GDI, and wakes up the adapter again (???)
I think this is just an oversight, this doesn’t look like hibernate process, but a regular GDI paint.
6. GFX receive S5 system power IRP, so it queues a D3 IRP, and sleeps.

## S4

### 1. Monitor D3

```cpp
0: kd> g
Device object (ffff808597120890) is for:
 00000096 \Driver\amduw23g DriverObject ffff80857e4ec790
Current Irp 00000000 RefCount 2 Type 0000001c Flags 00003044
SecurityDescriptor ffffce09eb284560 DevExt ffff8085971209e0 DevObjExt ffff808597120de8 DevNode ffff8085970c3c30 
ExtensionFlags (0000000000)  
Characteristics (0x00000180)  FILE_AUTOGENERATED_DEVICE_NAME, FILE_DEVICE_SECURE_OPEN
AttachedDevice (Upper) ffff80858ba30e10 \Driver\ACPI
Device queue is not busy.
PowerType:
1 ( DevicePowerState )
PowerState:
   +0x000 SystemState      : 4 ( PowerSystemSleeping3 )
   +0x000 DeviceState      : 4 ( PowerDeviceD3 )
dxgkrnl!DpiDispatchPower:
fffff800`80a59020 48895c2418      mov     qword ptr [rsp+18h],rbx
1: kd> k
 # Child-SP          RetAddr               Call Site
00 ffffa706`02da6dd8 fffff800`ee99b44b     dxgkrnl!DpiDispatchPower [onecoreuap\windows\core\dxkernel\dxgkrnl\port\dpport.cxx @ 3223] 
01 ffffa706`02da6de0 fffff800`ee8f7a43     nt!IopPoHandleIrp+0x3b [minkernel\ntos\io\iomgr\iosubs.c @ 3306] 
02 (Inline Function) --------`--------     nt!IopfCallDriver+0xde [minkernel\ntos\io\iomgr\iomgr.h @ 3756] 
03 ffffa706`02da6e10 fffff800`eea64069     nt!IofCallDriver+0xf3 [minkernel\ntos\io\iomgr\iosubs.c @ 3321] 
04 ffffa706`02da6e50 fffff800`80ebc0ec     nt!IoCallDriver+0x9 [minkernel\ntos\io\iomgr\iosubs.c @ 16795] 
05 ffffa706`02da6e80 fffff800`80ebb286     ACPI!ACPIFilterIrpSetPower+0xdc
06 ffffa706`02da6ee0 fffff800`ee99b44b     ACPI!ACPIDispatchIrp+0x1d6
07 ffffa706`02da6f60 fffff800`ee8f7a43     nt!IopPoHandleIrp+0x3b [minkernel\ntos\io\iomgr\iosubs.c @ 3306] 
08 (Inline Function) --------`--------     nt!IopfCallDriver+0xde [minkernel\ntos\io\iomgr\iomgr.h @ 3756] 
09 ffffa706`02da6f90 fffff800`eea64069     nt!IofCallDriver+0xf3 [minkernel\ntos\io\iomgr\iosubs.c @ 3321] 
0a ffffa706`02da6fd0 fffff800`80d15fa9     nt!IoCallDriver+0x9 [minkernel\ntos\io\iomgr\iosubs.c @ 16795] 
0b (Inline Function) --------`--------     Wdf01000!FxIrp::PoCallDriver+0x16 [minkernel\wdf\framework\shared\inc\private\km\FxIrpKm.hpp @ 94] 
0c ffffa706`02da7000 fffff800`80d15f08     Wdf01000!FxPkgFdo::_PowerPassDown+0x79 [minkernel\wdf\framework\shared\irphandlers\pnp\fdopower.cpp @ 85] 
0d ffffa706`02da7030 fffff800`80d1ab78     Wdf01000!FxPkgFdo::PowerReleasePendingDeviceIrp+0x38 [minkernel\wdf\framework\shared\irphandlers\pnp\fdopower.cpp @ 499] 
0e ffffa706`02da7060 fffff800`80d1a9eb     Wdf01000!FxPkgPnp::PowerGotoDxIoStoppedCommon+0x174 [minkernel\wdf\framework\shared\irphandlers\pnp\powerstatemachine.cpp @ 3137] 
0f (Inline Function) --------`--------     Wdf01000!FxPkgPnp::PowerGotoDxIoStopped+0x7 [minkernel\wdf\framework\shared\inc\private\common\FxPkgPnp.hpp @ 2957] 
10 ffffa706`02da70d0 fffff800`80d1c7d2     Wdf01000!FxPkgPnp::PowerGotoDNotZeroIoStopped+0xb [minkernel\wdf\framework\shared\irphandlers\pnp\powerstatemachine.cpp @ 2843] 
11 ffffa706`02da7100 fffff800`80d1c4a0     Wdf01000!FxPkgPnp::PowerEnterNewState+0x152 [minkernel\wdf\framework\shared\irphandlers\pnp\powerstatemachine.cpp @ 1705] 
12 ffffa706`02da7250 fffff800`80d1cb55     Wdf01000!FxPkgPnp::PowerProcessEventInner+0xe0 [minkernel\wdf\framework\shared\irphandlers\pnp\powerstatemachine.cpp @ 1617] 
13 ffffa706`02da72d0 fffff800`80d1c26c     Wdf01000!FxPkgPnp::PowerProcessEvent+0x15d [minkernel\wdf\framework\shared\irphandlers\pnp\powerstatemachine.cpp @ 1396] 
14 (Inline Function) --------`--------     Wdf01000!FxPkgFdo::LowerDevicePower+0x34 [minkernel\wdf\framework\shared\irphandlers\pnp\fdopower.cpp @ 414] 
15 ffffa706`02da7370 fffff800`80d1a265     Wdf01000!FxPkgFdo::DispatchDeviceSetPower+0x7c [minkernel\wdf\framework\shared\irphandlers\pnp\fdopower.cpp @ 350] 
16 ffffa706`02da73c0 fffff800`80d4a863     Wdf01000!FxPkgFdo::_DispatchSetPower+0x25 [minkernel\wdf\framework\shared\irphandlers\pnp\fdopower.cpp @ 120] 
17 ffffa706`02da73f0 fffff800`80d35be2     Wdf01000!FxPkgPnp::Dispatch+0x103 [minkernel\wdf\framework\shared\irphandlers\pnp\fxpkgpnp.cpp @ 794] 
18 (Inline Function) --------`--------     Wdf01000!DispatchWorker+0xea [minkernel\wdf\framework\shared\core\fxdevice.cpp @ 1587] 
19 (Inline Function) --------`--------     Wdf01000!FxDevice::Dispatch+0xf3 [minkernel\wdf\framework\shared\core\fxdevice.cpp @ 1601] 
1a ffffa706`02da7460 fffff800`ee99b24e     Wdf01000!FxDevice::DispatchWithLock+0x232 [minkernel\wdf\framework\shared\core\fxdevice.cpp @ 1445] 
1b ffffa706`02da74c0 fffff800`eea5594a     nt!PopIrpWorker+0x2de [minkernel\ntos\po\irpwork.c @ 608] 
1c ffffa706`02da7570 fffff800`eec7a004     nt!PspSystemThreadStartup+0x5a [minkernel\ntos\ps\psexec.c @ 11931] 
1d ffffa706`02da75c0 00000000`00000000     nt!KiStartSystemThread+0x34 [minkernel\ntos\ke\amd64\threadbg.asm @ 87] 
1: kd> r rdx
rdx=ffff80859b8645a0
1: kd> !irp ffff80859b8645a0
Irp is active with 6 stacks 3 is current (= 0xffff80859b864700)
 No Mdl: No System Buffer: Thread 00000000:  Irp stack trace.  
     cmd  flg cl Device   File     Completion-Context
 [N/A(0), N/A(0)]
            0  0 00000000 00000000 00000000-00000000    

			Args: 00000000 00000000 00000000 00000000
 [N/A(0), N/A(0)]
            0  0 00000000 00000000 00000000-00000000    

			Args: 00000000 00000000 00000000 00000000
>[IRP_MJ_POWER(16), IRP_MN_SET_POWER(2)]
            0 e0 ffff808597120890 00000000 fffff80080ebaad0-fffff80080ebaf00 Success Error Cancel 
	       \Driver\amduw23g	ACPI!ACPIDeviceIrpDeviceFilterRequest
			Args: 00000000 00000001 00000004 00000000
 [IRP_MJ_POWER(16), IRP_MN_SET_POWER(2)]
            0  1 ffff80858ba30e10 00000000 00000000-00000000    pending
	       \Driver\ACPI
			Args: 00000000 00000001 00000004 00000000
 [IRP_MJ_POWER(16), IRP_MN_SET_POWER(2)]
            0 e1 ffff80858d9dfd10 00000000 fffff800ee99c860-ffff8085978e7d90 Success Error Cancel pending
	       \Driver\monitor	nt!PopRequestCompletion
			Args: 00000000 00000001 00000004 00000000
 [N/A(0), N/A(0)]
            0  0 00000000 00000000 00000000-ffff8085978e7d90    

			Args: 00000000 00000000 00000000 00000000
```

### 2. D3 by PoFx

```cpp
1: kd> g
nt!PoRequestPowerIrp:
fffff800`ee99d550 4883ec48        sub     rsp,48h
4: kd> r r8
r8=0000000000000004
4: kd> k
 # Child-SP          RetAddr               Call Site
00 ffffa706`01c27128 fffff800`806d247e     nt!PoRequestPowerIrp [minkernel\ntos\po\pocall.c @ 124] 
01 ffffa706`01c27130 fffff800`806d20bc     dxgkrnl!DpiRequestDevicePowerIrp+0xe6 [onecoreuap\windows\core\dxkernel\dxgkrnl\port\dpshared.cxx @ 4462] 
02 ffffa706`01c27170 fffff800`806d1be9     dxgkrnl!DpiRequestDevicePowerState+0x3d4 [onecoreuap\windows\core\dxkernel\dxgkrnl\port\dpshared.cxx @ 5009] 
03 (Inline Function) --------`--------     dxgkrnl!DXGADAPTER::PowerRuntimeDevicePowerRequiredCallback+0x1e [onecoreuap\windows\core\dxkernel\dxgkrnl\core\adapter.cxx @ 1275] 
04 ffffa706`01c27200 fffff800`ee8f39d3     dxgkrnl!DxgkPowerRuntimeDevicePowerNotRequiredCallback+0x39 [onecoreuap\windows\core\dxkernel\dxgkrnl\core\adapterpublic.cxx @ 180] 
05 ffffa706`01c27240 fffff800`ee8fe847     nt!PopFxProcessWork+0x863 [minkernel\ntos\po\runtime.c @ 9476] 
06 ffffa706`01c27350 fffff800`ee8fe5ab     nt!PopFxDispatchPluginWorkOnce+0x22b [minkernel\ntos\po\runtime.c @ 19818] 
07 ffffa706`01c274d0 fffff800`eeb932e4     nt!PopFxProcessWorkPool+0x13b [minkernel\ntos\po\runtime.c @ 9913] 
08 ffffa706`01c27540 fffff800`eea5594a     nt!PopFxStaticWorkPoolThread+0x44 [minkernel\ntos\po\runtime.c @ 8747] 
09 ffffa706`01c27570 fffff800`eec7a004     nt!PspSystemThreadStartup+0x5a [minkernel\ntos\ps\psexec.c @ 11931] 
0a ffffa706`01c275c0 00000000`00000000     nt!KiStartSystemThread+0x34 [minkernel\ntos\ke\amd64\threadbg.asm @ 87] 
```

```cpp
4: kd> g
Device object (ffff80857e81f030) is for:
  \Driver\amduw23g DriverObject ffff80857e4ec790
Current Irp 00000000 RefCount 0 Type 00000023 Flags 00002004
SecurityDescriptor ffffce09eb4b94e0 DevExt ffff80857e81f180 DevObjExt ffff80857e820a80 
ExtensionFlags (0000000000)  
Characteristics (0x00000100)  FILE_DEVICE_SECURE_OPEN
AttachedTo (Lower) ffff8085779bbbd0 \Driver\ACPI
Device queue is not busy.
PowerType:
1 ( DevicePowerState )
PowerState:
   +0x000 SystemState      : 4 ( PowerSystemSleeping3 )
   +0x000 DeviceState      : 4 ( PowerDeviceD3 )
dxgkrnl!DpiDispatchPower:
fffff800`80a59020 48895c2418      mov     qword ptr [rsp+18h],rbx
2: kd> k
 # Child-SP          RetAddr               Call Site
00 ffffa706`02da74b8 fffff800`ee99b24e     dxgkrnl!DpiDispatchPower [onecoreuap\windows\core\dxkernel\dxgkrnl\port\dpport.cxx @ 3223] 
01 ffffa706`02da74c0 fffff800`eea5594a     nt!PopIrpWorker+0x2de [minkernel\ntos\po\irpwork.c @ 608] 
02 ffffa706`02da7570 fffff800`eec7a004     nt!PspSystemThreadStartup+0x5a [minkernel\ntos\ps\psexec.c @ 11931] 
03 ffffa706`02da75c0 00000000`00000000     nt!KiStartSystemThread+0x34 [minkernel\ntos\ke\amd64\threadbg.asm @ 87] 
```

### 3. D0 by LogonUI.exe

```cpp
2: kd> g
nt!PoRequestPowerIrp:
fffff800`ee99d550 4883ec48        sub     rsp,48h
0: kd> r r8
r8=0000000000000001
0: kd> k
 # Child-SP          RetAddr               Call Site
00 ffffa706`078d73c8 fffff800`806d247e     nt!PoRequestPowerIrp [minkernel\ntos\po\pocall.c @ 124] 
01 ffffa706`078d73d0 fffff800`806d1e50     dxgkrnl!DpiRequestDevicePowerIrp+0xe6 [onecoreuap\windows\core\dxkernel\dxgkrnl\port\dpshared.cxx @ 4462] 
02 ffffa706`078d7410 fffff800`8092d8cb     dxgkrnl!DpiRequestDevicePowerState+0x168 [onecoreuap\windows\core\dxkernel\dxgkrnl\port\dpshared.cxx @ 4902] 
03 (Inline Function) --------`--------     dxgkrnl!DXGADAPTER::WakeUpAdapter+0xb2 [onecoreuap\windows\core\dxkernel\dxgkrnl\core\adapter.cxx @ 3977] 
04 (Inline Function) --------`--------     dxgkrnl!DXGADAPTER::TryWakeUpFromD3State+0x223 [onecoreuap\windows\core\dxkernel\dxgkrnl\core\adapter.cxx @ 4025] 
05 ffffa706`078d74a0 fffff800`806bda61     dxgkrnl!DXGADAPTER::AcquireCoreResourceShared+0x2ab [onecoreuap\windows\core\dxkernel\dxgkrnl\core\adapter.cxx @ 4060] 
06 (Inline Function) --------`--------     dxgkrnl!COREACCESS::AcquireShared+0x4c [onecoreuap\windows\core\dxkernel\dxgkrnl\inc\adapter.hxx @ 7622] 
07 ffffa706`078d76d0 fffff800`809f7ca5     dxgkrnl!COREADAPTERACCESS::AcquireShared+0x61 [onecoreuap\windows\core\dxkernel\dxgkrnl\inc\adapter.hxx @ 7823] 
08 ffffa706`078d7710 fffff800`eee36aaa     dxgkrnl!DxgkSharedAllocationObDeleteProcedure+0x85 [onecoreuap\windows\core\dxkernel\dxgkrnl\core\ntobject.cxx @ 1209] 
09 ffffa706`078d7810 fffff800`ee935bac     nt!ObpRemoveObjectRoutine+0xea [minkernel\ntos\ob\obref.c @ 3304] 
0a (Inline Function) --------`--------     nt!ObfDereferenceObjectWithTag+0x6d [minkernel\ntos\ob\obref.c @ 645] 
0b ffffa706`078d7870 fffff800`806a9b04     nt!ObfDereferenceObject+0x7c [minkernel\ntos\ob\obref.c @ 686] 
0c ffffa706`078d78b0 fffff800`806a9aa4     dxgkrnl!CBufferRealization::~CBufferRealization+0x3c [onecoreuap\windows\core\compositionsurface\bufferrealization.cpp @ 67] 
0d ffffa706`078d78e0 fffff800`806aae98     dxgkrnl!CBufferRealization::`scalar deleting destructor'+0x14
0e ffffa706`078d7910 fffff800`806aae20     dxgkrnl!CCompositionBuffer::RemoveAllRealizations+0x54 [onecoreuap\windows\core\compositionsurface\compositionbuffer.cpp @ 469] 
0f ffffa706`078d7940 fffff800`806aadbc     dxgkrnl!CCompositionBuffer::~CCompositionBuffer+0x18 [onecoreuap\windows\core\compositionsurface\compositionbuffer.cpp @ 116] 
10 ffffa706`078d7970 fffff800`806aad24     dxgkrnl!CFlipExBuffer::~CFlipExBuffer+0x74 [onecoreuap\windows\core\compositionsurface\flipexbuffer.cpp @ 118] 
11 ffffa706`078d79a0 fffff800`806ca37c     dxgkrnl!CFlipExBuffer::`scalar deleting destructor'+0x14
12 ffffa706`078d79d0 fffff800`806ca2fe     dxgkrnl!CCompositionSurface::ReleaseAllBuffers+0x58 [onecoreuap\windows\core\compositionsurface\compositionsurface.cpp @ 1393] 
13 ffffa706`078d7a00 fffff800`806c9b62     dxgkrnl!CCompositionSurface::Delete+0xe [onecoreuap\windows\core\compositionsurface\compositionsurface.cpp @ 122] 
14 ffffa706`078d7a30 fffff800`eee36aaa     dxgkrnl!DxgkCompositionObject::Delete+0x62 [onecoreuap\windows\core\dxkernel\dxgkrnl\compobj\dxgkcompositionobject.cxx @ 268] 
15 ffffa706`078d7bc0 fffff800`ee82db79     nt!ObpRemoveObjectRoutine+0xea [minkernel\ntos\ob\obref.c @ 3304] 
16 ffffa706`078d7c20 fffff800`eee2eb95     nt!ObfDereferenceObjectWithTag+0x79 [minkernel\ntos\ob\obref.c @ 658] 
17 ffffa706`078d7c60 fffff800`eee2d2e9     nt!ObCloseHandleTableEntry+0x3e5 [minkernel\ntos\ob\obclose.c @ 220] 
18 (Inline Function) --------`--------     nt!ObpCloseHandle+0xb1 [minkernel\ntos\ob\obclose.c @ 353] 
19 ffffa706`078d7db0 fffff800`eec8c558     nt!NtClose+0xe9 [minkernel\ntos\ob\obclose.c @ 516] 
1a ffffa706`078d7e20 00007ffc`fcc1f9b4     nt!KiSystemServiceCopyEnd+0x28 [minkernel\ntos\ke\amd64\trap.asm @ 3648] 
1b 00000049`cce7e128 00007ffc`fa59d339     ntdll!NtClose+0x14
1c 00000049`cce7e130 00007ffc`f31fc2d8     KERNELBASE!CloseHandle+0x49
1d 00000049`cce7e160 00007ffc`f3205dbf     d3d11!SafeHANDLE::Close+0x18
1e 00000049`cce7e190 00007ffc`f3205d54     d3d11!NDXGI::CResource::FinalRelease+0x57
1f 00000049`cce7e1c0 00007ffc`f3205d29     d3d11!CLayeredObject<NDXGI::CResource>::~CLayeredObject<NDXGI::CResource>+0x1c
20 00000049`cce7e1f0 00007ffc`f3242600     d3d11!CLayeredObject<NDXGI::CResource>::Release+0x9
21 00000049`cce7e220 00007ffc`f3231ddc     d3d11!ATL::CComPtr<ID3D11LayeredUseCounted>::operator=+0x20
22 00000049`cce7e250 00007ffc`f324862a     d3d11!CUseCountedObject<NOutermost::CDeviceChild>::`vector deleting destructor'+0x2c
23 00000049`cce7e280 00007ffc`f32210ac     d3d11!CUseCountedObject<NOutermost::CDeviceChild>::UCDestroy+0x1a
24 00000049`cce7e2b0 00007ffc`f322c2af     d3d11!CUseCountedObject<NOutermost::CDeviceChild>::UCReleaseUse+0xac
25 00000049`cce7e2e0 00007ffc`f322c275     d3d11!CLockOwnerChild<CDevice,0>::UCReleaseUse+0x13
26 00000049`cce7e310 00007ffc`f321fe29     d3d11!CView<ID3D11DepthStencilView>::~CView<ID3D11DepthStencilView>+0x19
27 00000049`cce7e340 00007ffc`f3242600     d3d11!CLayeredObjectWithCLS<CRenderTargetView>::Release+0x9
28 00000049`cce7e370 00007ffc`f3231ddc     d3d11!ATL::CComPtr<ID3D11LayeredUseCounted>::operator=+0x20
29 00000049`cce7e3a0 00007ffc`f324862a     d3d11!CUseCountedObject<NOutermost::CDeviceChild>::`vector deleting destructor'+0x2c
2a 00000049`cce7e3d0 00007ffc`f3222afd     d3d11!CUseCountedObject<NOutermost::CDeviceChild>::UCDestroy+0x1a
2b 00000049`cce7e400 00007ffc`f3248a14     d3d11!CUseCountedObject<NOutermost::CDeviceChild>::Release+0x1cd
2c 00000049`cce7e430 00007ffc`f3a924e1     d3d11!CLayeredObject<CClassLinkage>::CContainedObject::Release+0x14
2d 00000049`cce7e460 00007ffc`f3afce7d     dcomp!XWinRT::InterfaceLifetimeTraits::Destroy<Windows::UI::Composition::ICompositionColorGradientStop>+0x1d
2e 00000049`cce7e490 00007ffc`f3afc332     dcomp!DirectComposition::CAtlasSurfacePool::FreeDeviceResources+0x35
2f 00000049`cce7e4c0 00007ffc`f3afc284     dcomp!DirectComposition::CAtlasSurfacePool::~CAtlasSurfacePool+0x76
30 00000049`cce7e4f0 00007ffc`f3aa3772     dcomp!DirectComposition::CAtlasSurfacePool::`vector deleting destructor'+0x14
31 00000049`cce7e520 00007ffc`f3b5925d     dcomp!CMILRefCountBaseT<IDCompositionInteractionConfigurationPartner,CMilObjectDeleter>::InternalRelease+0x72
32 00000049`cce7e550 00007ffc`f3b3b54b     dcomp!Microsoft::WRL::ComPtr<DirectComposition::CAtlasSurfacePool>::InternalRelease+0x19
33 00000049`cce7e580 00007ffc`f3b3b4e4     dcomp!DirectComposition::CDynamicPool::~CDynamicPool+0x2f
34 00000049`cce7e5b0 00007ffc`f3aa3772     dcomp!DirectComposition::CDynamicPool::`vector deleting destructor'+0x14
35 00000049`cce7e5e0 00007ffc`f3a9dd4c     dcomp!CMILRefCountBaseT<IDCompositionInteractionConfigurationPartner,CMilObjectDeleter>::InternalRelease+0x72
36 00000049`cce7e610 00007ffc`f3b2497a     dcomp!DirectComposition::CDevice::Commit+0xa9c
37 00000049`cce7e7a0 00007ffc`e55cbdcc     dcomp!Windows::UI::Composition::InteropCompositor::Api::SynchronizedCommit+0x8a
38 00000049`cce7e7e0 00007ffc`e590becf     Windows_UI_Xaml!DCompTreeHost::CommitMainDevice+0x100 [onecoreuap\windows\dxaml\xcp\components\comptree\dcomptreehost.cpp @ 1562] 
39 00000049`cce7e8b0 00007ffc`e590b4df     Windows_UI_Xaml!CCoreServices::PauseDCompAnimationsOnSuspend+0x53 [onecoreuap\windows\dxaml\xcp\core\dll\xcpcore.cpp @ 7801] 
3a 00000049`cce7e8e0 00007ffc`e590b11f     Windows_UI_Xaml!CCoreServices::OnSuspend+0x103 [onecoreuap\windows\dxaml\xcp\core\dll\xcpcore.cpp @ 7573] 
3b 00000049`cce7e940 00007ffc`e57fbacb     Windows_UI_Xaml!CCoreServices::OnBackgroundResourceTimeout+0x2f [onecoreuap\windows\dxaml\xcp\core\dll\xcpcore.cpp @ 10225] 
3c 00000049`cce7e970 00007ffc`e5522dd7     Windows_UI_Xaml!CControlBase::ScriptCallback+0xcb [onecoreuap\windows\dxaml\xcp\control\common\shared\controlbase.cpp @ 279] 
3d (Inline Function) --------`--------     Windows_UI_Xaml!CXcpDispatcher::OnScriptCallback+0x1eb [onecoreuap\windows\dxaml\xcp\win\shared\xcpwindow.cpp @ 1367] 
3e 00000049`cce7e9f0 00007ffc`e552159e     Windows_UI_Xaml!CXcpDispatcher::OnWindowMessage+0x23f [onecoreuap\windows\dxaml\xcp\win\shared\xcpwindow.cpp @ 1121] 
3f (Inline Function) --------`--------     Windows_UI_Xaml!CXcpDispatcher::ProcessMessage+0x34 [onecoreuap\windows\dxaml\xcp\win\shared\xcpwindow.cpp @ 913] 
40 00000049`cce7eb30 00007ffc`e58a9d86     Windows_UI_Xaml!CXcpDispatcher::WindowProc+0xce [onecoreuap\windows\dxaml\xcp\win\shared\xcpwindow.cpp @ 851] 
41 (Inline Function) --------`--------     Windows_UI_Xaml!CDeferredInvoke::DispatchQueuedMessage+0x67 [onecoreuap\windows\dxaml\xcp\win\shared\xcpwindow.cpp @ 292] 
42 (Inline Function) --------`--------     Windows_UI_Xaml!CXcpDispatcher::MessageTimerCallback+0x67 [onecoreuap\windows\dxaml\xcp\win\shared\xcpwindow.cpp @ 1563] 
43 00000049`cce7eb90 00007ffc`f419430d     Windows_UI_Xaml!CXcpDispatcher::MessageTimerCallbackStatic+0x76 [onecoreuap\windows\dxaml\xcp\win\shared\xcpwindow.cpp @ 1555] 
44 00000049`cce7ebe0 00007ffc`f419356b     CoreMessaging!CFlat::SehSafe::Execute<<lambda_654db17c35df07198786f0867aa10de6> >+0x21
45 00000049`cce7ec10 00007ffc`f41e3cc2     CoreMessaging!Microsoft::CoreUI::Dispatch::TimeoutHandler::ImportAdapter$+0x6b
46 00000049`cce7ec50 00007ffc`f4196fc4     CoreMessaging!Microsoft::CoreUI::Dispatch::TimeoutManager::Callback_OnDispatch+0x102
47 00000049`cce7eca0 00007ffc`f4196b5d     CoreMessaging!Microsoft::CoreUI::Dispatch::Dispatcher::Callback_DispatchLoop+0x334
48 00000049`cce7eda0 00007ffc`f41a52bd     CoreMessaging!Microsoft::CoreUI::Dispatch::EventLoop::Callback_RunCoreLoop+0x11d
49 00000049`cce7ee10 00007ffc`f41a594d     CoreMessaging!Microsoft::CoreUI::Dispatch::UserAdapter::DrainCoreMessagingQueue+0x21d
4a 00000049`cce7ee90 00007ffc`f41a55e8     CoreMessaging!Microsoft::CoreUI::Dispatch::UserAdapter::OnUserDispatch+0x85
4b 00000049`cce7eed0 00007ffc`f41a3f30     CoreMessaging!Microsoft::CoreUI::Dispatch::UserAdapter::DoWork+0x188
4c 00000049`cce7ef40 00007ffc`fc2352a1     CoreMessaging!Microsoft::CoreUI::Dispatch::UserAdapter::WindowProc+0x40
4d 00000049`cce7efb0 00007ffc`fc234b3c     user32!UserCallWinProcCheckWow+0x341
4e 00000049`cce7f110 00007ffc`fc2665a3     user32!DispatchClientMessage+0x9c
4f 00000049`cce7f170 00007ffc`fcc237f4     user32!_fnDWORD+0x33
50 00000049`cce7f1d0 00007ffc`fa1a12b4     ntdll!KiUserCallbackDispatcherContinue
51 00000049`cce7f258 00007ffc`fc22872f     win32u!NtUserPeekMessage+0x14
52 00000049`cce7f260 00007ffc`fc2286b8     user32!_PeekMessage+0x3f
53 00000049`cce7f2d0 00007ffc`fb31ed5b     user32!PeekMessageW+0x168
54 00000049`cce7f340 00007ffc`fb31df78     combase!ModernSTAWaitContext::PumpMessages+0xfb [onecore\com\combase\dcomrem\modernsta.cpp @ 2217] 
55 00000049`cce7f3b0 00007ffc`fb3ec23c     combase!ModernSTAWaitContext::Wait+0xa50 [onecore\com\combase\dcomrem\modernsta.cpp @ 1360] 
56 00000049`cce7f660 00007ffc`fb3ec0aa     combase!ModernSTAWaitInNewContext+0xd4 [onecore\com\combase\dcomrem\modernsta.cpp @ 2728] 
57 00000049`cce7f740 00007ffc`fb3101b2     combase!ModernSTAThreadWaitForHandles+0x9a [onecore\com\combase\dcomrem\modernsta.cpp @ 2973] 
58 00000049`cce7f7c0 00007ffc`d8dd2bf6     combase!CoWaitForMultipleHandles+0xe2 [onecore\com\combase\dcomrem\sync.cxx @ 122] 
59 00000049`cce7f800 00007ffc`d8dd278b     Windows_UI_XamlHost!ASTAThreadHost::ASTAThreadHostThreadProc+0xe6
5a 00000049`cce7f8d0 00007ffc`fc437bea     Windows_UI_XamlHost!ASTAThreadHost::s_ASTAThreadHostThreadProc+0x2b
5b 00000049`cce7f900 00007ffc`fb13e8d7     SHCORE!_WrapperThreadProc+0x15a
5c 00000049`cce7fa00 00007ffc`fcb7bf2c     KERNEL32!BaseThreadInitThunk+0x17
5d 00000049`cce7fa30 00000000`00000000     ntdll!RtlUserThreadStart+0x2c
0: kd> !process
PROCESS ffff8085986eb0c0
    SessionId: 1  Cid: 1d7c    Peb: 49cc997000  ParentCid: 05a0
    DirBase: 6eb857000  ObjectTable: ffffce09f7f8f080  HandleCount: 1356.
    Image: LogonUI.exe
    VadRoot ffff80859a52dd00 Vads 243 Clone 0 Private 6047. Modified 214. Locked 323.
    DeviceMap ffffce09e6291880
    Token                             ffffce09f805c0a0
    ElapsedTime                       00:03:15.389
    UserTime                          00:00:00.015
    KernelTime                        00:00:00.000
    QuotaPoolUsage[PagedPool]         642952
    QuotaPoolUsage[NonPagedPool]      34168
    Working Set Sizes (now,min,max)  (16721, 50, 345) (66884KB, 200KB, 1380KB)
    PeakWorkingSetSize                16527
    VirtualSize                       2101934 Mb
    PeakVirtualSize                   2101934 Mb
    PageFaultCount                    17238
    MemoryPriority                    FOREGROUND
    BasePriority                      13
    CommitCharge                      9522
    Job                               ffff80858ba05060
```

```cpp
0: kd> g
Device object (ffff80857e81f030) is for:
  \Driver\amduw23g DriverObject ffff80857e4ec790
Current Irp 00000000 RefCount 0 Type 00000023 Flags 00002004
SecurityDescriptor ffffce09eb4b94e0 DevExt ffff80857e81f180 DevObjExt ffff80857e820a80 
ExtensionFlags (0000000000)  
Characteristics (0x00000100)  FILE_DEVICE_SECURE_OPEN
AttachedTo (Lower) ffff8085779bbbd0 \Driver\ACPI
Device queue is not busy.
PowerType:
1 ( DevicePowerState )
PowerState:
   +0x000 SystemState      : 1 ( PowerSystemWorking )
   +0x000 DeviceState      : 1 ( PowerDeviceD0 )
dxgkrnl!DpiDispatchPower:
fffff800`80a59020 48895c2418      mov     qword ptr [rsp+18h],rbx
4: kd> k
 # Child-SP          RetAddr               Call Site
00 ffffa706`02d9f4b8 fffff800`ee99b24e     dxgkrnl!DpiDispatchPower [onecoreuap\windows\core\dxkernel\dxgkrnl\port\dpport.cxx @ 3223] 
01 ffffa706`02d9f4c0 fffff800`eea5594a     nt!PopIrpWorker+0x2de [minkernel\ntos\po\irpwork.c @ 608] 
02 ffffa706`02d9f570 fffff800`eec7a004     nt!PspSystemThreadStartup+0x5a [minkernel\ntos\ps\psexec.c @ 11931] 
03 ffffa706`02d9f5c0 00000000`00000000     nt!KiStartSystemThread+0x34 [minkernel\ntos\ke\amd64\threadbg.asm @ 87] 
```

### 4. D3 by PoFx

```cpp
4: kd> g
nt!PoRequestPowerIrp:
fffff800`ee99d550 4883ec48        sub     rsp,48h
2: kd> r r8
r8=0000000000000004
2: kd> k
 # Child-SP          RetAddr               Call Site
00 ffffa706`01c27128 fffff800`806d247e     nt!PoRequestPowerIrp [minkernel\ntos\po\pocall.c @ 124] 
01 ffffa706`01c27130 fffff800`806d20bc     dxgkrnl!DpiRequestDevicePowerIrp+0xe6 [onecoreuap\windows\core\dxkernel\dxgkrnl\port\dpshared.cxx @ 4462] 
02 ffffa706`01c27170 fffff800`806d1be9     dxgkrnl!DpiRequestDevicePowerState+0x3d4 [onecoreuap\windows\core\dxkernel\dxgkrnl\port\dpshared.cxx @ 5009] 
03 (Inline Function) --------`--------     dxgkrnl!DXGADAPTER::PowerRuntimeDevicePowerRequiredCallback+0x1e [onecoreuap\windows\core\dxkernel\dxgkrnl\core\adapter.cxx @ 1275] 
04 ffffa706`01c27200 fffff800`ee8f39d3     dxgkrnl!DxgkPowerRuntimeDevicePowerNotRequiredCallback+0x39 [onecoreuap\windows\core\dxkernel\dxgkrnl\core\adapterpublic.cxx @ 180] 
05 ffffa706`01c27240 fffff800`ee8fe847     nt!PopFxProcessWork+0x863 [minkernel\ntos\po\runtime.c @ 9476] 
06 ffffa706`01c27350 fffff800`ee8fe5ab     nt!PopFxDispatchPluginWorkOnce+0x22b [minkernel\ntos\po\runtime.c @ 19818] 
07 ffffa706`01c274d0 fffff800`eeb932e4     nt!PopFxProcessWorkPool+0x13b [minkernel\ntos\po\runtime.c @ 9913] 
08 ffffa706`01c27540 fffff800`eea5594a     nt!PopFxStaticWorkPoolThread+0x44 [minkernel\ntos\po\runtime.c @ 8747] 
09 ffffa706`01c27570 fffff800`eec7a004     nt!PspSystemThreadStartup+0x5a [minkernel\ntos\ps\psexec.c @ 11931] 
0a ffffa706`01c275c0 00000000`00000000     nt!KiStartSystemThread+0x34 [minkernel\ntos\ke\amd64\threadbg.asm @ 87] 
```

```cpp
2: kd> g
Device object (ffff80857e81f030) is for:
  \Driver\amduw23g DriverObject ffff80857e4ec790
Current Irp 00000000 RefCount 0 Type 00000023 Flags 00002004
SecurityDescriptor ffffce09eb4b94e0 DevExt ffff80857e81f180 DevObjExt ffff80857e820a80 
ExtensionFlags (0000000000)  
Characteristics (0x00000100)  FILE_DEVICE_SECURE_OPEN
AttachedTo (Lower) ffff8085779bbbd0 \Driver\ACPI
Device queue is not busy.
PowerType:
1 ( DevicePowerState )
PowerState:
   +0x000 SystemState      : 4 ( PowerSystemSleeping3 )
   +0x000 DeviceState      : 4 ( PowerDeviceD3 )
dxgkrnl!DpiDispatchPower:
fffff800`80a59020 48895c2418      mov     qword ptr [rsp+18h],rbx
0: kd> k
 # Child-SP          RetAddr               Call Site
00 ffffa706`02da74b8 fffff800`ee99b24e     dxgkrnl!DpiDispatchPower [onecoreuap\windows\core\dxkernel\dxgkrnl\port\dpport.cxx @ 3223] 
01 ffffa706`02da74c0 fffff800`eea5594a     nt!PopIrpWorker+0x2de [minkernel\ntos\po\irpwork.c @ 608] 
02 ffffa706`02da7570 fffff800`eec7a004     nt!PspSystemThreadStartup+0x5a [minkernel\ntos\ps\psexec.c @ 11931] 
03 ffffa706`02da75c0 00000000`00000000     nt!KiStartSystemThread+0x34 [minkernel\ntos\ke\amd64\threadbg.asm @ 87] 
```

### 5. D0 by Win32k PowerOffGdi

```cpp
0: kd> g
nt!PoRequestPowerIrp:
fffff800`ee99d550 4883ec48        sub     rsp,48h
0: kd> r r8
r8=0000000000000001
0: kd> k
 # Child-SP          RetAddr               Call Site
00 ffffa706`037fc978 fffff800`806d247e     nt!PoRequestPowerIrp [minkernel\ntos\po\pocall.c @ 124] 
01 ffffa706`037fc980 fffff800`806d1e50     dxgkrnl!DpiRequestDevicePowerIrp+0xe6 [onecoreuap\windows\core\dxkernel\dxgkrnl\port\dpshared.cxx @ 4462] 
02 ffffa706`037fc9c0 fffff800`8092d8cb     dxgkrnl!DpiRequestDevicePowerState+0x168 [onecoreuap\windows\core\dxkernel\dxgkrnl\port\dpshared.cxx @ 4902] 
03 (Inline Function) --------`--------     dxgkrnl!DXGADAPTER::WakeUpAdapter+0xb2 [onecoreuap\windows\core\dxkernel\dxgkrnl\core\adapter.cxx @ 3977] 
04 (Inline Function) --------`--------     dxgkrnl!DXGADAPTER::TryWakeUpFromD3State+0x223 [onecoreuap\windows\core\dxkernel\dxgkrnl\core\adapter.cxx @ 4025] 
05 ffffa706`037fca50 fffff800`8092867b     dxgkrnl!DXGADAPTER::AcquireCoreResourceShared+0x2ab [onecoreuap\windows\core\dxkernel\dxgkrnl\core\adapter.cxx @ 4060] 
06 (Inline Function) --------`--------     dxgkrnl!COREACCESS::AcquireShared+0x4c [onecoreuap\windows\core\dxkernel\dxgkrnl\inc\adapter.hxx @ 7622] 
07 (Inline Function) --------`--------     dxgkrnl!COREADAPTERACCESS::AcquireShared+0x4c [onecoreuap\windows\core\dxkernel\dxgkrnl\inc\adapter.hxx @ 7823] 
08 ffffa706`037fcc80 fffff800`809280a6     dxgkrnl!SetPointerPositionForDisplaySource+0x11b [onecoreuap\windows\core\dxkernel\dxgkrnl\core\pointer.cxx @ 1795] 
09 ffffa706`037fcfa0 fffff800`80927e71     dxgkrnl!DxgkSetPointerPosition+0x216 [onecoreuap\windows\core\dxkernel\dxgkrnl\core\pointer.cxx @ 2118] 
0a ffffa706`037fd050 fffff800`8d7aaef7     dxgkrnl!DxgkCddSetPointerPosition+0x41 [onecoreuap\windows\core\dxkernel\dxgkrnl\core\pointer.cxx @ 2151] 
0b ffffa706`037fd090 fffff800`8d22bfb2     cdd!DrvMovePointerEx+0x137
0c ffffa706`037fd0e0 fffff800`8d42b8b4     win32kfull!vMovePointer+0x7e
0d ffffa706`037fd140 fffff800`8d288591     win32kfull!GreHidePointerInternal+0x60
0e ffffa706`037fd170 fffff800`8d29a782     win32kfull!GreHidePointer+0x12d
0f ffffa706`037fd1b0 fffff800`8d2a2ec1     win32kfull!CursorApiRouter::HidePointer+0x5a
10 ffffa706`037fd1e0 fffff800`8e0c977d     win32kfull!PowerOffGdi+0xe1
11 ffffa706`037fd210 fffff800`8e04c13f     win32kbase!PowerOffGdi+0x2d
12 ffffa706`037fd240 fffff800`8e04a614     win32kbase!xxxUserPowerStateCalloutWorker+0x7f3
13 ffffa706`037fd380 fffff800`8d3e0a62     win32kbase!xxxUserPowerCalloutWorker+0x214
14 ffffa706`037fd400 fffff800`805a861a     win32kfull!NtUserUserPowerCalloutWorker+0x22
15 ffffa706`037fd430 fffff800`eec8c558     win32k!NtUserUserPowerCalloutWorker+0x2e
16 ffffa706`037fd460 00007ffc`fa1ac9b4     nt!KiSystemServiceCopyEnd+0x28 [minkernel\ntos\ke\amd64\trap.asm @ 3648] 
17 000000fb`9a1bfe48 00007ffc`f9dd3ae6     win32u!NtUserUserPowerCalloutWorker+0x14
18 000000fb`9a1bfe50 00007ffc`fcb7bf42     winsrvext!PowerNotificationThread+0x66
19 000000fb`9a1bfe80 00000000`00000000     ntdll!RtlUserThreadStart+0x42
```

```cpp
0: kd> g
Device object (ffff80857e81f030) is for:
  \Driver\amduw23g DriverObject ffff80857e4ec790
Current Irp 00000000 RefCount 0 Type 00000023 Flags 00002004
SecurityDescriptor ffffce09eb4b94e0 DevExt ffff80857e81f180 DevObjExt ffff80857e820a80 
ExtensionFlags (0000000000)  
Characteristics (0x00000100)  FILE_DEVICE_SECURE_OPEN
AttachedTo (Lower) ffff8085779bbbd0 \Driver\ACPI
Device queue is not busy.
PowerType:
1 ( DevicePowerState )
PowerState:
   +0x000 SystemState      : 1 ( PowerSystemWorking )
   +0x000 DeviceState      : 1 ( PowerDeviceD0 )
dxgkrnl!DpiDispatchPower:
fffff800`80a59020 48895c2418      mov     qword ptr [rsp+18h],rbx
6: kd> k
 # Child-SP          RetAddr               Call Site
00 ffffa706`02d9f4b8 fffff800`ee99b24e     dxgkrnl!DpiDispatchPower [onecoreuap\windows\core\dxkernel\dxgkrnl\port\dpport.cxx @ 3223] 
01 ffffa706`02d9f4c0 fffff800`eea5594a     nt!PopIrpWorker+0x2de [minkernel\ntos\po\irpwork.c @ 608] 
02 ffffa706`02d9f570 fffff800`eec7a004     nt!PspSystemThreadStartup+0x5a [minkernel\ntos\ps\psexec.c @ 11931] 
03 ffffa706`02d9f5c0 00000000`00000000     nt!KiStartSystemThread+0x34 [minkernel\ntos\ke\amd64\threadbg.asm @ 87] 
```

### 6. D3 by DxgkPowerArbiter

TBD: Who send this to power arbiter work queue?

```cpp
6: kd> g
nt!PoRequestPowerIrp:
fffff800`ee99d550 4883ec48        sub     rsp,48h
4: kd> r r8
r8=0000000000000004
4: kd> k
 # Child-SP          RetAddr               Call Site
00 ffffa706`030b7448 fffff800`806d247e     nt!PoRequestPowerIrp [minkernel\ntos\po\pocall.c @ 124] 
01 ffffa706`030b7450 fffff800`806d223a     dxgkrnl!DpiRequestDevicePowerIrp+0xe6 [onecoreuap\windows\core\dxkernel\dxgkrnl\port\dpshared.cxx @ 4462] 
02 ffffa706`030b7490 fffff800`80983339     dxgkrnl!DpiFinishSuspendAdapter+0xba [onecoreuap\windows\core\dxkernel\dxgkrnl\port\dppower.cxx @ 1954] 
03 ffffa706`030b74e0 fffff800`eea5594a     dxgkrnl!DpiPowerArbiterThread+0x289 [onecoreuap\windows\core\dxkernel\dxgkrnl\port\dppower.cxx @ 2197] 
04 ffffa706`030b7570 fffff800`eec7a004     nt!PspSystemThreadStartup+0x5a [minkernel\ntos\ps\psexec.c @ 11931] 
05 ffffa706`030b75c0 00000000`00000000     nt!KiStartSystemThread+0x34 [minkernel\ntos\ke\amd64\threadbg.asm @ 87] 
```

```cpp
4: kd> g
Device object (ffff80857e81f030) is for:
  \Driver\amduw23g DriverObject ffff80857e4ec790
Current Irp 00000000 RefCount 0 Type 00000023 Flags 00002004
SecurityDescriptor ffffce09eb4b94e0 DevExt ffff80857e81f180 DevObjExt ffff80857e820a80 
ExtensionFlags (0000000000)  
Characteristics (0x00000100)  FILE_DEVICE_SECURE_OPEN
AttachedTo (Lower) ffff8085779bbbd0 \Driver\ACPI
Device queue is not busy.
PowerType:
1 ( DevicePowerState )
PowerState:
   +0x000 SystemState      : 4 ( PowerSystemSleeping3 )
   +0x000 DeviceState      : 4 ( PowerDeviceD3 )
dxgkrnl!DpiDispatchPower:
fffff800`80a59020 48895c2418      mov     qword ptr [rsp+18h],rbx
0: kd> k
 # Child-SP          RetAddr               Call Site
00 ffffa706`02d9f4b8 fffff800`ee99b24e     dxgkrnl!DpiDispatchPower [onecoreuap\windows\core\dxkernel\dxgkrnl\port\dpport.cxx @ 3223] 
01 ffffa706`02d9f4c0 fffff800`eea5594a     nt!PopIrpWorker+0x2de [minkernel\ntos\po\irpwork.c @ 608] 
02 ffffa706`02d9f570 fffff800`eec7a004     nt!PspSystemThreadStartup+0x5a [minkernel\ntos\ps\psexec.c @ 11931] 
03 ffffa706`02d9f5c0 00000000`00000000     nt!KiStartSystemThread+0x34 [minkernel\ntos\ke\amd64\threadbg.asm @ 87] 
```

### 7. D0 by explorer.exe

```cpp
4: kd> g
nt!PoRequestPowerIrp:
fffff800`ee99d550 4883ec48        sub     rsp,48h
6: kd> r r8
r8=0000000000000001
6: kd> k
 # Child-SP          RetAddr               Call Site
00 ffffa706`04a0e6b8 fffff800`806d247e     nt!PoRequestPowerIrp [minkernel\ntos\po\pocall.c @ 124] 
01 ffffa706`04a0e6c0 fffff800`806d1e50     dxgkrnl!DpiRequestDevicePowerIrp+0xe6 [onecoreuap\windows\core\dxkernel\dxgkrnl\port\dpshared.cxx @ 4462] 
02 ffffa706`04a0e700 fffff800`8092dc6b     dxgkrnl!DpiRequestDevicePowerState+0x168 [onecoreuap\windows\core\dxkernel\dxgkrnl\port\dpshared.cxx @ 4902] 
03 (Inline Function) --------`--------     dxgkrnl!DXGADAPTER::WakeUpAdapter+0xbc [onecoreuap\windows\core\dxkernel\dxgkrnl\core\adapter.cxx @ 3977] 
04 ffffa706`04a0e790 fffff800`80a34df9     dxgkrnl!DXGADAPTER::TryWakeUpFromD3State+0x18b [onecoreuap\windows\core\dxkernel\dxgkrnl\core\adapter.cxx @ 4025] 
05 (Inline Function) --------`--------     dxgkrnl!ADAPTER_RENDER::TryWakeUpFromD3State+0xd [onecoreuap\windows\core\dxkernel\dxgkrnl\inc\adapter.hxx @ 4020] 
06 (Inline Function) --------`--------     dxgkrnl!DXGDEVICE::AcquireDeviceLockExclusive+0x407 [onecoreuap\windows\core\dxkernel\dxgkrnl\inc\device.inl @ 236] 
07 (Inline Function) --------`--------     dxgkrnl!DXGDEVICEACCESSLOCKEXCLUSIVECDD::{ctor}+0x437 [onecoreuap\windows\core\dxkernel\dxgkrnl\inc\device.hxx @ 1647] 
08 ffffa706`04a0e7e0 fffff800`80a34820     dxgkrnl!DxgkpCddSyncGPUAccess+0x559 [onecoreuap\windows\core\dxkernel\dxgkrnl\core\cdd.cxx @ 2133] 
09 ffffa706`04a0e970 fffff800`8d7a5843     dxgkrnl!DxgkCddSyncGPUAccess+0x50 [onecoreuap\windows\core\dxkernel\dxgkrnl\core\cdd.cxx @ 2211] 
0a ffffa706`04a0e9c0 fffff800`8d7af764     cdd!CStagingPoolBase::AllocateRect+0x3d3
0b ffffa706`04a0ea50 fffff800`8d7bdb9c     cdd!CStagingPool::GetGdiSurface+0x214
0c ffffa706`04a0ead0 fffff800`8d7b370f     cdd!BitBltBitmap+0x61c
0d ffffa706`04a0eee0 fffff800`8d7b35df     cdd!DrvBitBltInternal+0x11f
0e ffffa706`04a0f170 fffff800`8d313f93     cdd!DrvCopyBits+0x4f
0f ffffa706`04a0f1e0 fffff800`8d313cf4     win32kfull!SpBitBlt+0x293
10 ffffa706`04a0f730 fffff800`8d224790     win32kfull!SpCopyBits+0x44
11 ffffa706`04a0f7a0 fffff800`8d390ef1     win32kfull!GrepBitBltImpl+0x1130
12 ffffa706`04a0fbe0 fffff800`805a2521     win32kfull!NtGdiBitBlt+0x101
13 ffffa706`04a0fd40 fffff800`eec8c558     win32k!NtGdiBitBlt+0xa1
14 ffffa706`04a0fdb0 00007ffc`fa1a1354     nt!KiSystemServiceCopyEnd+0x28 [minkernel\ntos\ke\amd64\trap.asm @ 3648] 
15 00000000`0012e6c8 00007ffc`fa0a09da     win32u!NtGdiBitBlt+0x14
16 00000000`0012e6d0 00007ffc`fc824a4b     gdi32full!BitBlt+0xba
17 00000000`0012e7b0 00007ffc`f6d1900b     GDI32!BitBltStub+0xab
18 00000000`0012e820 00007ffc`f6d187b5     UxTheme!CPaintBuffer::_PaintImmediate+0x19f
19 00000000`0012e8b0 00007ffc`e8b2e522     UxTheme!EndBufferedPaint+0x255
1a 00000000`0012e8f0 00007ffc`e8b2dacd     comctl32!CLVDrawManager::_PaintWorkArea+0x106
1b 00000000`0012e970 00007ffc`e8b2d8bd     comctl32!CLVDrawManager::_OnPaintWorkAreas+0xfd
1c 00000000`0012ea00 00007ffc`e8b2d787     comctl32!CLVDrawManager::_OnPaint+0xc1
1d 00000000`0012eab0 00007ffc`e8b9661f     comctl32!CLVDrawManager::OnPaint+0x5b
1e 00000000`0012eae0 00007ffc`e8b958ee     comctl32!CListView::WndProc+0x5ef
1f 00000000`0012ed10 00007ffc`fc2352a1     comctl32!CListView::s_WndProc+0x5e
20 00000000`0012ed60 00007ffc`fc234d7c     user32!UserCallWinProcCheckWow+0x341
21 00000000`0012eec0 00007ffc`e8b44b38     user32!CallWindowProcW+0x16c
22 00000000`0012ef30 00007ffc`e8b44834     comctl32!CallNextSubclassProc+0xa8
23 00000000`0012efc0 00007ffc`e8b44b38     comctl32!TTSubclassProc+0x114
24 00000000`0012f070 00007ffc`e8b44a68     comctl32!CallNextSubclassProc+0xa8
25 00000000`0012f100 00007ffc`fa95a59c     comctl32!DefSubclassProc+0x88
26 00000000`0012f150 00007ffc`e8b44b38     SHELL32!CListViewHost::s_ListViewSubclassWndProc+0x21c
27 00000000`0012f280 00007ffc`e8b4490f     comctl32!CallNextSubclassProc+0xa8
28 00000000`0012f310 00007ffc`fc2352a1     comctl32!MasterSubclassProc+0xaf
29 00000000`0012f3b0 00007ffc`fc234b3c     user32!UserCallWinProcCheckWow+0x341
2a 00000000`0012f510 00007ffc`fc2665a3     user32!DispatchClientMessage+0x9c
2b 00000000`0012f570 00007ffc`fcc237f4     user32!_fnDWORD+0x33
2c 00000000`0012f5d0 00007ffc`fa1a18b4     ntdll!KiUserCallbackDispatcherContinue
2d 00000000`0012f658 00007ffc`fc232f78     win32u!NtUserDispatchMessage+0x14
2e 00000000`0012f660 00007ffc`faae567f     user32!DispatchMessageWorker+0x348
2f 00000000`0012f6e0 00007ffc`faaa32bf     SHELL32!CDesktopBrowser::_PeekForAMessage+0x11f
30 00000000`0012f760 00007ffc`fad5ad9a     SHELL32!CDesktopBrowser::_MessageLoop+0x3f
31 00000000`0012f7b0 00007ff7`2abb528a     SHELL32!SHDesktopMessageLoop+0x9a
32 00000000`0012f7f0 00007ff7`2abd90f5     Explorer!wWinMain+0xb06
33 00000000`0012fc40 00007ffc`fb13e8d7     Explorer!__scrt_common_main_seh+0x105
34 00000000`0012fc80 00007ffc`fcb7bf2c     KERNEL32!BaseThreadInitThunk+0x17
35 00000000`0012fcb0 00000000`00000000     ntdll!RtlUserThreadStart+0x2c
6: kd> !process
PROCESS ffff808598f5f080
    SessionId: 1  Cid: 2058    Peb: 002df000  ParentCid: 1ad0
    DirBase: 74af44000  ObjectTable: ffffce09f327c980  HandleCount: 4480.
    Image: explorer.exe
    VadRoot ffff808598f1b580 Vads 720 Clone 0 Private 28062. Modified 855. Locked 4754.
    DeviceMap ffffce09f1fcb810
    Token                             ffffce09f32c6730
    ElapsedTime                       00:28:58.595
    UserTime                          00:00:00.125
    KernelTime                        00:00:00.171
    QuotaPoolUsage[PagedPool]         1938992
    QuotaPoolUsage[NonPagedPool]      102224
    Working Set Sizes (now,min,max)  (59937, 50, 345) (239748KB, 200KB, 1380KB)
    PeakWorkingSetSize                63861
    VirtualSize                       2102761 Mb
    PeakVirtualSize                   2102901 Mb
    PageFaultCount                    131063
    MemoryPriority                    BACKGROUND
    BasePriority                      8
    CommitCharge                      40976
    Job                               ffff80858ba05060
```

```cpp
6: kd> g
Device object (ffff80857e81f030) is for:
  \Driver\amduw23g DriverObject ffff80857e4ec790
Current Irp 00000000 RefCount 0 Type 00000023 Flags 00002004
SecurityDescriptor ffffce09eb4b94e0 DevExt ffff80857e81f180 DevObjExt ffff80857e820a80 
ExtensionFlags (0000000000)  
Characteristics (0x00000100)  FILE_DEVICE_SECURE_OPEN
AttachedTo (Lower) ffff8085779bbbd0 \Driver\ACPI
Device queue is not busy.
PowerType:
1 ( DevicePowerState )
PowerState:
   +0x000 SystemState      : 1 ( PowerSystemWorking )
   +0x000 DeviceState      : 1 ( PowerDeviceD0 )
dxgkrnl!DpiDispatchPower:
fffff800`80a59020 48895c2418      mov     qword ptr [rsp+18h],rbx
5: kd> k
 # Child-SP          RetAddr               Call Site
00 ffffa706`046874b8 fffff800`ee99b24e     dxgkrnl!DpiDispatchPower [onecoreuap\windows\core\dxkernel\dxgkrnl\port\dpport.cxx @ 3223] 
01 ffffa706`046874c0 fffff800`eea5594a     nt!PopIrpWorker+0x2de [minkernel\ntos\po\irpwork.c @ 608] 
02 ffffa706`04687570 fffff800`eec7a004     nt!PspSystemThreadStartup+0x5a [minkernel\ntos\ps\psexec.c @ 11931] 
03 ffffa706`046875c0 00000000`00000000     nt!KiStartSystemThread+0x34 [minkernel\ntos\ke\amd64\threadbg.asm @ 87] 
```

### 8. [BasicDisplay] BasicDisplay receive S5

```cpp
5: kd> g
Device object (ffff80857e31e030) is for:
  \Driver\BasicDisplay DriverObject ffff80857df48c20
Current Irp 00000000 RefCount 0 Type 00000023 Flags 00002004
SecurityDescriptor ffffce09e66156a0 DevExt ffff80857e31e180 DevObjExt ffff80857e31fa80 
ExtensionFlags (0000000000)  
Characteristics (0x00000100)  FILE_DEVICE_SECURE_OPEN
AttachedTo (Lower) ffff808575ad1df0 \Driver\PnpManager
Device queue is not busy.
PowerType:
0 ( SystemPowerState )
PowerState:
   +0x000 SystemState      : 5 ( PowerSystemHibernate )
   +0x000 DeviceState      : 5 ( PowerDeviceMaximum )
dxgkrnl!DpiDispatchPower:
fffff800`80a59020 48895c2418      mov     qword ptr [rsp+18h],rbx
6: kd> k
 # Child-SP          RetAddr               Call Site
00 ffffa706`0669f4b8 fffff800`ee99b24e     dxgkrnl!DpiDispatchPower [onecoreuap\windows\core\dxkernel\dxgkrnl\port\dpport.cxx @ 3223] 
01 ffffa706`0669f4c0 fffff800`eea5594a     nt!PopIrpWorker+0x2de [minkernel\ntos\po\irpwork.c @ 608] 
02 ffffa706`0669f570 fffff800`eec7a004     nt!PspSystemThreadStartup+0x5a [minkernel\ntos\ps\psexec.c @ 11931] 
03 ffffa706`0669f5c0 00000000`00000000     nt!KiStartSystemThread+0x34 [minkernel\ntos\ke\amd64\threadbg.asm @ 87] 
```

### 9. [BasicRender] BasicRender receive S5

```cpp
6: kd> g
Device object (ffff808588b0f030) is for:
  \Driver\BasicRender DriverObject ffff80857df5ddc0
Current Irp 00000000 RefCount 0 Type 00000023 Flags 00002004
SecurityDescriptor ffffce09e66156a0 DevExt ffff808588b0f180 DevObjExt ffff808588b10a80 
ExtensionFlags (0000000000)  
Characteristics (0x00000100)  FILE_DEVICE_SECURE_OPEN
AttachedTo (Lower) ffff808575bd8650 \Driver\PnpManager
Device queue is not busy.
PowerType:
0 ( SystemPowerState )
PowerState:
   +0x000 SystemState      : 5 ( PowerSystemHibernate )
   +0x000 DeviceState      : 5 ( PowerDeviceMaximum )
dxgkrnl!DpiDispatchPower:
fffff800`80a59020 48895c2418      mov     qword ptr [rsp+18h],rbx
6: kd> k
 # Child-SP          RetAddr               Call Site
00 ffffa706`0469f4b8 fffff800`ee99b24e     dxgkrnl!DpiDispatchPower [onecoreuap\windows\core\dxkernel\dxgkrnl\port\dpport.cxx @ 3223] 
01 ffffa706`0469f4c0 fffff800`eea5594a     nt!PopIrpWorker+0x2de [minkernel\ntos\po\irpwork.c @ 608] 
02 ffffa706`0469f570 fffff800`eec7a004     nt!PspSystemThreadStartup+0x5a [minkernel\ntos\ps\psexec.c @ 11931] 
03 ffffa706`0469f5c0 00000000`00000000     nt!KiStartSystemThread+0x34 [minkernel\ntos\ke\amd64\threadbg.asm @ 87] 
```

### 10. Monitor Receive S5

```cpp
6: kd> g
Device object (ffff808597120890) is for:
 00000096 \Driver\amduw23g DriverObject ffff80857e4ec790
Current Irp 00000000 RefCount 1 Type 0000001c Flags 00003044
SecurityDescriptor ffffce09eb284560 DevExt ffff8085971209e0 DevObjExt ffff808597120de8 DevNode ffff8085970c3c30 
ExtensionFlags (0000000000)  
Characteristics (0x00000180)  FILE_AUTOGENERATED_DEVICE_NAME, FILE_DEVICE_SECURE_OPEN
AttachedDevice (Upper) ffff80858ba30e10 \Driver\ACPI
Device queue is not busy.
PowerType:
0 ( SystemPowerState )
PowerState:
   +0x000 SystemState      : 5 ( PowerSystemHibernate )
   +0x000 DeviceState      : 5 ( PowerDeviceMaximum )
dxgkrnl!DpiDispatchPower:
fffff800`80a59020 48895c2418      mov     qword ptr [rsp+18h],rbx
3: kd> k
 # Child-SP          RetAddr               Call Site
00 ffffa706`08b5f118 fffff800`ee99b44b     dxgkrnl!DpiDispatchPower [onecoreuap\windows\core\dxkernel\dxgkrnl\port\dpport.cxx @ 3223] 
01 ffffa706`08b5f120 fffff800`ee8f7a43     nt!IopPoHandleIrp+0x3b [minkernel\ntos\io\iomgr\iosubs.c @ 3306] 
02 (Inline Function) --------`--------     nt!IopfCallDriver+0xde [minkernel\ntos\io\iomgr\iomgr.h @ 3756] 
03 ffffa706`08b5f150 fffff800`eea64069     nt!IofCallDriver+0xf3 [minkernel\ntos\io\iomgr\iosubs.c @ 3321] 
04 ffffa706`08b5f190 fffff800`80ebbcaa     nt!IoCallDriver+0x9 [minkernel\ntos\io\iomgr\iosubs.c @ 16795] 
05 ffffa706`08b5f1c0 fffff800`80ebc174     ACPI!ACPIDispatchForwardPowerIrp+0x4a
06 ffffa706`08b5f1f0 fffff800`80ebb286     ACPI!ACPIFilterIrpSetPower+0x164
07 ffffa706`08b5f250 fffff800`ee99b44b     ACPI!ACPIDispatchIrp+0x1d6
08 ffffa706`08b5f2d0 fffff800`ee8f7a43     nt!IopPoHandleIrp+0x3b [minkernel\ntos\io\iomgr\iosubs.c @ 3306] 
09 (Inline Function) --------`--------     nt!IopfCallDriver+0xde [minkernel\ntos\io\iomgr\iomgr.h @ 3756] 
0a ffffa706`08b5f300 fffff800`eea64069     nt!IofCallDriver+0xf3 [minkernel\ntos\io\iomgr\iosubs.c @ 3321] 
0b ffffa706`08b5f340 fffff800`80d1a3c0     nt!IoCallDriver+0x9 [minkernel\ntos\io\iomgr\iosubs.c @ 16795] 
0c (Inline Function) --------`--------     Wdf01000!FxIrp::PoCallDriver+0x1a [minkernel\wdf\framework\shared\inc\private\km\FxIrpKm.hpp @ 94] 
0d ffffa706`08b5f370 fffff800`80d1a25a     Wdf01000!FxPkgFdo::DispatchSystemSetPower+0x150 [minkernel\wdf\framework\shared\irphandlers\pnp\fdopower.cpp @ 286] 
0e ffffa706`08b5f3c0 fffff800`80d4a863     Wdf01000!FxPkgFdo::_DispatchSetPower+0x1a [minkernel\wdf\framework\shared\irphandlers\pnp\fdopower.cpp @ 122] 
0f ffffa706`08b5f3f0 fffff800`80d35be2     Wdf01000!FxPkgPnp::Dispatch+0x103 [minkernel\wdf\framework\shared\irphandlers\pnp\fxpkgpnp.cpp @ 794] 
10 (Inline Function) --------`--------     Wdf01000!DispatchWorker+0xea [minkernel\wdf\framework\shared\core\fxdevice.cpp @ 1587] 
11 (Inline Function) --------`--------     Wdf01000!FxDevice::Dispatch+0xf3 [minkernel\wdf\framework\shared\core\fxdevice.cpp @ 1601] 
12 ffffa706`08b5f460 fffff800`ee99b24e     Wdf01000!FxDevice::DispatchWithLock+0x232 [minkernel\wdf\framework\shared\core\fxdevice.cpp @ 1445] 
13 ffffa706`08b5f4c0 fffff800`eea5594a     nt!PopIrpWorker+0x2de [minkernel\ntos\po\irpwork.c @ 608] 
14 ffffa706`08b5f570 fffff800`eec7a004     nt!PspSystemThreadStartup+0x5a [minkernel\ntos\ps\psexec.c @ 11931] 
15 ffffa706`08b5f5c0 00000000`00000000     nt!KiStartSystemThread+0x34 [minkernel\ntos\ke\amd64\threadbg.asm @ 87] 
5: kd> !devstack ffff808597120890
  !DevObj           !DrvObj            !DevExt           ObjectName
  ffff80858d9dfd10  \Driver\monitor    ffff8085952f3a80  
  ffff80858ba30e10  \Driver\ACPI       ffff80857557b930  
> ffff808597120890  \Driver\amduw23g   ffff8085971209e0  00000096
!DevNode ffff8085970c3c30 :
  DeviceInst is "DISPLAY\SHP158E\5&37c9fbba&0&UID512"
  ServiceName is "monitor"

```

### 11. GFX Receive S5

```cpp
3: kd> g
Device object (ffff80857e81f030) is for:
  \Driver\amduw23g DriverObject ffff80857e4ec790
Current Irp 00000000 RefCount 0 Type 00000023 Flags 00002004
SecurityDescriptor ffffce09eb4b94e0 DevExt ffff80857e81f180 DevObjExt ffff80857e820a80 
ExtensionFlags (0000000000)  
Characteristics (0x00000100)  FILE_DEVICE_SECURE_OPEN
AttachedTo (Lower) ffff8085779bbbd0 \Driver\ACPI
Device queue is not busy.
PowerType:
0 ( SystemPowerState )
PowerState:
   +0x000 SystemState      : 5 ( PowerSystemHibernate )
   +0x000 DeviceState      : 5 ( PowerDeviceMaximum )
dxgkrnl!DpiDispatchPower:
fffff800`80a59020 48895c2418      mov     qword ptr [rsp+18h],rbx
5: kd> k
 # Child-SP          RetAddr               Call Site
00 ffffa706`02da74b8 fffff800`ee99b24e     dxgkrnl!DpiDispatchPower [onecoreuap\windows\core\dxkernel\dxgkrnl\port\dpport.cxx @ 3223] 
01 ffffa706`02da74c0 fffff800`eea5594a     nt!PopIrpWorker+0x2de [minkernel\ntos\po\irpwork.c @ 608] 
02 ffffa706`02da7570 fffff800`eec7a004     nt!PspSystemThreadStartup+0x5a [minkernel\ntos\ps\psexec.c @ 11931] 
03 ffffa706`02da75c0 00000000`00000000     nt!KiStartSystemThread+0x34 [minkernel\ntos\ke\amd64\threadbg.asm @ 87] 
```

### 12. D3 by S5 IRP

```cpp
5: kd> g
nt!PoRequestPowerIrp:
fffff800`ee99d550 4883ec48        sub     rsp,48h
5: kd> r r8
r8=0000000000000004
5: kd> k
 # Child-SP          RetAddr               Call Site
00 ffffa706`02da72a8 fffff800`80a7261a     nt!PoRequestPowerIrp [minkernel\ntos\po\pocall.c @ 124] 
01 ffffa706`02da72b0 fffff800`80a715ae     dxgkrnl!DpiFdoHandleSystemPower+0x752 [onecoreuap\windows\core\dxkernel\dxgkrnl\port\dppower.cxx @ 1549] 
02 ffffa706`02da7370 fffff800`80a59100     dxgkrnl!DpiFdoDispatchPower+0x2e [onecoreuap\windows\core\dxkernel\dxgkrnl\port\dppower.cxx @ 289] 
03 ffffa706`02da73a0 fffff800`ee99b24e     dxgkrnl!DpiDispatchPower+0xe0 [onecoreuap\windows\core\dxkernel\dxgkrnl\port\dpport.cxx @ 3317] 
04 ffffa706`02da74c0 fffff800`eea5594a     nt!PopIrpWorker+0x2de [minkernel\ntos\po\irpwork.c @ 608] 
05 ffffa706`02da7570 fffff800`eec7a004     nt!PspSystemThreadStartup+0x5a [minkernel\ntos\ps\psexec.c @ 11931] 
06 ffffa706`02da75c0 00000000`00000000     nt!KiStartSystemThread+0x34 [minkernel\ntos\ke\amd64\threadbg.asm @ 87] 
```

```cpp
5: kd> g
Device object (ffff80857e81f030) is for:
  \Driver\amduw23g DriverObject ffff80857e4ec790
Current Irp 00000000 RefCount 0 Type 00000023 Flags 00002004
SecurityDescriptor ffffce09eb4b94e0 DevExt ffff80857e81f180 DevObjExt ffff80857e820a80 
ExtensionFlags (0000000000)  
Characteristics (0x00000100)  FILE_DEVICE_SECURE_OPEN
AttachedTo (Lower) ffff8085779bbbd0 \Driver\ACPI
Device queue is not busy.
PowerType:
1 ( DevicePowerState )
PowerState:
   +0x000 SystemState      : 4 ( PowerSystemSleeping3 )
   +0x000 DeviceState      : 4 ( PowerDeviceD3 )
dxgkrnl!DpiDispatchPower:
fffff800`80a59020 48895c2418      mov     qword ptr [rsp+18h],rbx
6: kd> k
 # Child-SP          RetAddr               Call Site
00 ffffa706`02d9f4b8 fffff800`ee99b24e     dxgkrnl!DpiDispatchPower [onecoreuap\windows\core\dxkernel\dxgkrnl\port\dpport.cxx @ 3223] 
01 ffffa706`02d9f4c0 fffff800`eea5594a     nt!PopIrpWorker+0x2de [minkernel\ntos\po\irpwork.c @ 608] 
02 ffffa706`02d9f570 fffff800`eec7a004     nt!PspSystemThreadStartup+0x5a [minkernel\ntos\ps\psexec.c @ 11931] 
03 ffffa706`02d9f5c0 00000000`00000000     nt!KiStartSystemThread+0x34 [minkernel\ntos\ke\amd64\threadbg.asm @ 87] 
```

### 🎉Hibernate

## S3

### 1. D3 request on monitor

```
2: kd> g
ParseAndGetNameSpaceObject: object CTYP not found
Device object (ffffc804a0981890) is for:
 0000008f \Driver\amduw23g DriverObject ffffc8048b2ce280
Current Irp 00000000 RefCount 2 Type 0000001c Flags 00003044
SecurityDescriptor ffff8e0d41fc75e0 DevExt ffffc804a09819e0 DevObjExt ffffc804a0981de8 DevNode ffffc804a0937c30
ExtensionFlags (0000000000)
Characteristics (0x00000180)  FILE_AUTOGENERATED_DEVICE_NAME, FILE_DEVICE_SECURE_OPEN
AttachedDevice (Upper) ffffc80484a5a040 \Driver\ACPI
Device queue is not busy.
PowerType:
1 ( DevicePowerState )
PowerState:
   +0x000 SystemState      : 4 ( PowerSystemSleeping3 )
   +0x000 DeviceState      : 4 ( PowerDeviceD3 )
dxgkrnl!DpiDispatchPower:
fffff802`7b359020 48895c2418      mov     qword ptr [rsp+18h],rbx
2: kd> k
 # Child-SP          RetAddr               Call Site
00 fffffc07`f108edd8 fffff802`e939b44b     dxgkrnl!DpiDispatchPower [onecoreuap\windows\core\dxkernel\dxgkrnl\port\dpport.cxx @ 3223]
01 fffffc07`f108ede0 fffff802`e92f7a43     nt!IopPoHandleIrp+0x3b [minkernel\ntos\io\iomgr\iosubs.c @ 3306]
02 (Inline Function) --------`--------     nt!IopfCallDriver+0xde [minkernel\ntos\io\iomgr\iomgr.h @ 3756]
03 fffffc07`f108ee10 fffff802`e9464069     nt!IofCallDriver+0xf3 [minkernel\ntos\io\iomgr\iosubs.c @ 3321]
04 fffffc07`f108ee50 fffff802`7b7bc0ec     nt!IoCallDriver+0x9 [minkernel\ntos\io\iomgr\iosubs.c @ 16795]
05 fffffc07`f108ee80 fffff802`7b7bb286     ACPI!ACPIFilterIrpSetPower+0xdc
06 fffffc07`f108eee0 fffff802`e939b44b     ACPI!ACPIDispatchIrp+0x1d6
07 fffffc07`f108ef60 fffff802`e92f7a43     nt!IopPoHandleIrp+0x3b [minkernel\ntos\io\iomgr\iosubs.c @ 3306]
08 (Inline Function) --------`--------     nt!IopfCallDriver+0xde [minkernel\ntos\io\iomgr\iomgr.h @ 3756]
09 fffffc07`f108ef90 fffff802`e9464069     nt!IofCallDriver+0xf3 [minkernel\ntos\io\iomgr\iosubs.c @ 3321]
0a fffffc07`f108efd0 fffff802`7b615fa9     nt!IoCallDriver+0x9 [minkernel\ntos\io\iomgr\iosubs.c @ 16795]
0b (Inline Function) --------`--------     Wdf01000!FxIrp::PoCallDriver+0x16 [minkernel\wdf\framework\shared\inc\private\km\FxIrpKm.hpp @ 94]
0c fffffc07`f108f000 fffff802`7b615f08     Wdf01000!FxPkgFdo::_PowerPassDown+0x79 [minkernel\wdf\framework\shared\irphandlers\pnp\fdopower.cpp @ 85]
0d fffffc07`f108f030 fffff802`7b61ab78     Wdf01000!FxPkgFdo::PowerReleasePendingDeviceIrp+0x38 [minkernel\wdf\framework\shared\irphandlers\pnp\fdopower.cpp @ 499]
0e fffffc07`f108f060 fffff802`7b61a9eb     Wdf01000!FxPkgPnp::PowerGotoDxIoStoppedCommon+0x174 [minkernel\wdf\framework\shared\irphandlers\pnp\powerstatemachine.cpp @ 3137]
0f (Inline Function) --------`--------     Wdf01000!FxPkgPnp::PowerGotoDxIoStopped+0x7 [minkernel\wdf\framework\shared\inc\private\common\FxPkgPnp.hpp @ 2957]
10 fffffc07`f108f0d0 fffff802`7b61c7d2     Wdf01000!FxPkgPnp::PowerGotoDNotZeroIoStopped+0xb [minkernel\wdf\framework\shared\irphandlers\pnp\powerstatemachine.cpp @ 2843]
11 fffffc07`f108f100 fffff802`7b61c4a0     Wdf01000!FxPkgPnp::PowerEnterNewState+0x152 [minkernel\wdf\framework\shared\irphandlers\pnp\powerstatemachine.cpp @ 1705]
12 fffffc07`f108f250 fffff802`7b61cb55     Wdf01000!FxPkgPnp::PowerProcessEventInner+0xe0 [minkernel\wdf\framework\shared\irphandlers\pnp\powerstatemachine.cpp @ 1617]
13 fffffc07`f108f2d0 fffff802`7b61c26c     Wdf01000!FxPkgPnp::PowerProcessEvent+0x15d [minkernel\wdf\framework\shared\irphandlers\pnp\powerstatemachine.cpp @ 1396]
14 (Inline Function) --------`--------     Wdf01000!FxPkgFdo::LowerDevicePower+0x34 [minkernel\wdf\framework\shared\irphandlers\pnp\fdopower.cpp @ 414]
15 fffffc07`f108f370 fffff802`7b61a265     Wdf01000!FxPkgFdo::DispatchDeviceSetPower+0x7c [minkernel\wdf\framework\shared\irphandlers\pnp\fdopower.cpp @ 350]
16 fffffc07`f108f3c0 fffff802`7b64a863     Wdf01000!FxPkgFdo::_DispatchSetPower+0x25 [minkernel\wdf\framework\shared\irphandlers\pnp\fdopower.cpp @ 120]
17 fffffc07`f108f3f0 fffff802`7b635be2     Wdf01000!FxPkgPnp::Dispatch+0x103 [minkernel\wdf\framework\shared\irphandlers\pnp\fxpkgpnp.cpp @ 794]
18 (Inline Function) --------`--------     Wdf01000!DispatchWorker+0xea [minkernel\wdf\framework\shared\core\fxdevice.cpp @ 1587]
19 (Inline Function) --------`--------     Wdf01000!FxDevice::Dispatch+0xf3 [minkernel\wdf\framework\shared\core\fxdevice.cpp @ 1601]
1a fffffc07`f108f460 fffff802`e939b24e     Wdf01000!FxDevice::DispatchWithLock+0x232 [minkernel\wdf\framework\shared\core\fxdevice.cpp @ 1445]
1b fffffc07`f108f4c0 fffff802`e945594a     nt!PopIrpWorker+0x2de [minkernel\ntos\po\irpwork.c @ 608]
1c fffffc07`f108f570 fffff802`e967a004     nt!PspSystemThreadStartup+0x5a [minkernel\ntos\ps\psexec.c @ 11931]
1d fffffc07`f108f5c0 00000000`00000000     nt!KiStartSystemThread+0x34 [minkernel\ntos\ke\amd64\threadbg.asm @ 87]
```

### 2. D3 for GFX

```cpp
2: kd> g
ParseAndGetNameSpaceObject: object CTYP not found
nt!PoRequestPowerIrp:
fffff802`e939d550 4883ec48        sub     rsp,48h
17: kd> k
 # Child-SP          RetAddr               Call Site
00 fffffc07`ede27128 fffff802`7afd247e     nt!PoRequestPowerIrp [minkernel\ntos\po\pocall.c @ 124]
01 fffffc07`ede27130 fffff802`7afd20bc     dxgkrnl!DpiRequestDevicePowerIrp+0xe6 [onecoreuap\windows\core\dxkernel\dxgkrnl\port\dpshared.cxx @ 4462]
02 fffffc07`ede27170 fffff802`7afd1be9     dxgkrnl!DpiRequestDevicePowerState+0x3d4 [onecoreuap\windows\core\dxkernel\dxgkrnl\port\dpshared.cxx @ 5009]
03 (Inline Function) --------`--------     dxgkrnl!DXGADAPTER::PowerRuntimeDevicePowerRequiredCallback+0x1e [onecoreuap\windows\core\dxkernel\dxgkrnl\core\adapter.cxx @ 1275]
04 fffffc07`ede27200 fffff802`e92f39d3     dxgkrnl!DxgkPowerRuntimeDevicePowerNotRequiredCallback+0x39 [onecoreuap\windows\core\dxkernel\dxgkrnl\core\adapterpublic.cxx @ 180]
05 fffffc07`ede27240 fffff802`e92fe847     nt!PopFxProcessWork+0x863 [minkernel\ntos\po\runtime.c @ 9476]
06 fffffc07`ede27350 fffff802`e92fe5ab     nt!PopFxDispatchPluginWorkOnce+0x22b [minkernel\ntos\po\runtime.c @ 19818]
07 fffffc07`ede274d0 fffff802`e95932e4     nt!PopFxProcessWorkPool+0x13b [minkernel\ntos\po\runtime.c @ 9913]
08 fffffc07`ede27540 fffff802`e945594a     nt!PopFxStaticWorkPoolThread+0x44 [minkernel\ntos\po\runtime.c @ 8747]
09 fffffc07`ede27570 fffff802`e967a004     nt!PspSystemThreadStartup+0x5a [minkernel\ntos\ps\psexec.c @ 11931]
0a fffffc07`ede275c0 00000000`00000000     nt!KiStartSystemThread+0x34 [minkernel\ntos\ke\amd64\threadbg.asm @ 87]
17: kd> r r8
r8=0000000000000004
```

```cpp
17: kd> g
Device object (ffffc804881c0030) is for:
  \Driver\amduw23g DriverObject ffffc8048b2ce280
Current Irp 00000000 RefCount 0 Type 00000023 Flags 00002004
SecurityDescriptor ffff8e0d49f67ea0 DevExt ffffc804881c0180 DevObjExt ffffc804881c1a80 
ExtensionFlags (0000000000)  
Characteristics (0x00000100)  FILE_DEVICE_SECURE_OPEN
AttachedTo (Lower) ffffc8047d9ecce0 \Driver\ACPI
Device queue is not busy.
PowerType:
1 ( DevicePowerState )
PowerState:
   +0x000 SystemState      : 4 ( PowerSystemSleeping3 )
   +0x000 DeviceState      : 4 ( PowerDeviceD3 )
dxgkrnl!DpiDispatchPower:
fffff802`7b359020 48895c2418      mov     qword ptr [rsp+18h],rbx
4: kd> k
 # Child-SP          RetAddr               Call Site
00 fffffc07`ede1f4b8 fffff802`e939b24e     dxgkrnl!DpiDispatchPower [onecoreuap\windows\core\dxkernel\dxgkrnl\port\dpport.cxx @ 3223] 
01 fffffc07`ede1f4c0 fffff802`e945594a     nt!PopIrpWorker+0x2de [minkernel\ntos\po\irpwork.c @ 608] 
02 fffffc07`ede1f570 fffff802`e967a004     nt!PspSystemThreadStartup+0x5a [minkernel\ntos\ps\psexec.c @ 11931] 
03 fffffc07`ede1f5c0 00000000`00000000     nt!KiStartSystemThread+0x34 [minkernel\ntos\ke\amd64\threadbg.asm @ 87] 
```

### 3. D0 for LogonUI

```cpp
16: kd> k
 # Child-SP          RetAddr               Call Site
00 fffffc07`f46c7808 fffff802`7afd247e     nt!PoRequestPowerIrp [minkernel\ntos\po\pocall.c @ 124] 
01 fffffc07`f46c7810 fffff802`7afd1e50     dxgkrnl!DpiRequestDevicePowerIrp+0xe6 [onecoreuap\windows\core\dxkernel\dxgkrnl\port\dpshared.cxx @ 4462] 
02 fffffc07`f46c7850 fffff802`7b22dc6b     dxgkrnl!DpiRequestDevicePowerState+0x168 [onecoreuap\windows\core\dxkernel\dxgkrnl\port\dpshared.cxx @ 4902] 
03 (Inline Function) --------`--------     dxgkrnl!DXGADAPTER::WakeUpAdapter+0xbc [onecoreuap\windows\core\dxkernel\dxgkrnl\core\adapter.cxx @ 3977] 
04 fffffc07`f46c78e0 fffff802`7b23166d     dxgkrnl!DXGADAPTER::TryWakeUpFromD3State+0x18b [onecoreuap\windows\core\dxkernel\dxgkrnl\core\adapter.cxx @ 4025] 
05 (Inline Function) --------`--------     dxgkrnl!ADAPTER_RENDER::TryWakeUpFromD3State+0x9 [onecoreuap\windows\core\dxkernel\dxgkrnl\inc\adapter.hxx @ 4020] 
06 (Inline Function) --------`--------     dxgkrnl!DXGDEVICE::AcquireStopLockShared+0xa8e [onecoreuap\windows\core\dxkernel\dxgkrnl\inc\device.inl @ 345] 
07 (Inline Function) --------`--------     dxgkrnl!DXGDEVICELOCKONAPPROPRIATETHREADMODEL::{ctor}+0xb00 [onecoreuap\windows\core\dxkernel\dxgkrnl\inc\device.hxx @ 1753] 
08 fffffc07`f46c7930 fffff802`7b230870     dxgkrnl!DxgkMakeResidentInternal+0xded [onecoreuap\windows\core\dxkernel\dxgkrnl\core\pagingqueue.cxx @ 558] 
09 fffffc07`f46c7df0 fffff802`e968c558     dxgkrnl!DxgkMakeResident+0x10 [onecoreuap\windows\core\dxkernel\dxgkrnl\core\pagingqueue.cxx @ 722] 
0a fffffc07`f46c7e20 00007ff9`45355354     nt!KiSystemServiceCopyEnd+0x28 [minkernel\ntos\ke\amd64\trap.asm @ 3648] 
0b 00000014`fee7dd08 00007ff9`3dc475c9     win32u!NtGdiDdDDIMakeResident+0x14
0c 00000014`fee7dd10 00007ff9`3dc47588     d3d11!CallAndLogImpl<long (__cdecl*)(D3DDDI_MAKERESIDENT * __ptr64),D3DDDI_MAKERESIDENT * __ptr64>+0x11
0d 00000014`fee7dd70 00007ff9`366fad6a     d3d11!NDXGI::CDevice::MakeResidentCB+0x48
0e (Inline Function) --------`--------     amdxx64!Pal::Wddm::Thunk::MakeResident+0x21 [C:\constructicon\builds\gfx\seven\24.20\drivers\d3d\dxxp\imported\pal\src\core\os\wddm\wddmThunks.h @ 871] 
0f 00000014`fee7ddd0 00007ff9`366fa882     amdxx64!Pal::Wddm::Device::MakeResident+0x28a [C:\constructicon\builds\gfx\seven\24.20\drivers\d3d\dxxp\imported\pal\src\core\os\wddm\wddmDevice.cpp @ 2889] 
10 00000014`fee7e690 00007ff9`364dea4f     amdxx64!Pal::Wddm::Device::AddGpuMemoryReferences+0x222 [C:\constructicon\builds\gfx\seven\24.20\drivers\d3d\dxxp\imported\pal\src\core\os\wddm\wddmDevice.cpp @ 2706] 
11 (Inline Function) --------`--------     amdxx64!Dxx::Core::Queue::FlushResidencyForSubmission+0x43 [C:\constructicon\builds\gfx\seven\24.20\drivers\d3d\dxxp\core\corequeue.cpp @ 469] 
12 00000014`fee7e740 00007ff9`3649e4af     amdxx64!Dxx::Core::Queue::SubmitEx+0x25f [C:\constructicon\builds\gfx\seven\24.20\drivers\d3d\dxxp\core\corequeue.cpp @ 617] 
13 00000014`fee7e9b0 00007ff9`36500813     amdxx64!Dxx::Core::Context::Flush+0x42f [C:\constructicon\builds\gfx\seven\24.20\drivers\d3d\dxxp\core\corecontext.cpp @ 5992] 
14 (Inline Function) --------`--------     amdxx64!Dxx::Core::Device::FlushInternal+0x16 [C:\constructicon\builds\gfx\seven\24.20\drivers\d3d\dxxp\core\coredevice.cpp @ 6064] 
15 (Inline Function) --------`--------     amdxx64!Dxx::Core::Device::Flush+0x16 [C:\constructicon\builds\gfx\seven\24.20\drivers\d3d\dxxp\core\coredevice.h @ 504] 
16 00000014`fee7ea80 00007ff9`365b2c99     amdxx64!Dxx::DxDevice::HookDestroyResource+0x2a3 [C:\constructicon\builds\gfx\seven\24.20\drivers\d3d\dxxp\ddi\dxdevice.cpp @ 1991] 
17 00000014`fee7eac0 00007ff9`365bbd1d     amdxx64!Dxx::DxBaseDevice::HookDestroyResource+0x19 [C:\constructicon\builds\gfx\seven\24.20\drivers\d3d\dxxp\layers\dxbasedevicehooks.cpp @ 1061] 
18 (Inline Function) --------`--------     amdxx64!Dxx::DxBaseDevice::NextLayerHookDestroyResource+0x1a [C:\constructicon\builds\gfx\seven\24.20\drivers\d3d\dxxp\layers\dxbasedevice.h @ 2636] 
19 00000014`fee7eaf0 00007ff9`365bb2c3     amdxx64!Dxx::FreeThreadDevice::FlushDeferredDestroyDeque+0x10d [C:\constructicon\builds\gfx\seven\24.20\drivers\d3d\dxxp\layers\freethreaddevice.cpp @ 391] 
1a 00000014`fee7eb30 00007ff9`365b2619     amdxx64!Dxx::FreeThreadDevice::HookFlush+0x43 [C:\constructicon\builds\gfx\seven\24.20\drivers\d3d\dxxp\layers\freethreaddevice.cpp @ 113] 
1b 00000014`fee7eb60 00007ff9`365b2619     amdxx64!Dxx::DxBaseDevice::HookFlush+0x19 [C:\constructicon\builds\gfx\seven\24.20\drivers\d3d\dxxp\layers\dxbasedevicehooks.cpp @ 786] 
1c 00000014`fee7eb90 00007ff9`365b2619     amdxx64!Dxx::DxBaseDevice::HookFlush+0x19 [C:\constructicon\builds\gfx\seven\24.20\drivers\d3d\dxxp\layers\dxbasedevicehooks.cpp @ 786] 
1d 00000014`fee7ebc0 00007ff9`3dc26422     amdxx64!Dxx::DxBaseDevice::HookFlush+0x19 [C:\constructicon\builds\gfx\seven\24.20\drivers\d3d\dxxp\layers\dxbasedevicehooks.cpp @ 786] 
1e 00000014`fee7ebf0 00007ff9`3dc35491     d3d11!NDXGI::CDevice::Flush+0x82
1f 00000014`fee7ec20 00007ff9`2e2c98fe     d3d11!NDXGI::CDevice::Trim+0x81
20 00000014`fee7ec90 00007ff9`2e2c9d84     Windows_UI_Xaml!CD3D11DeviceInstance::ReleaseScratchResources+0xaa [onecoreuap\windows\dxaml\xcp\plat\win\desktop\d3d11deviceinstance.cpp @ 1149] 
21 00000014`fee7ed10 00007ff9`2e2c9d26     Windows_UI_Xaml!CD3D11Device::ReleaseScratchResources+0x2c [onecoreuap\windows\dxaml\xcp\plat\win\desktop\d3d11device.cpp @ 476] 
22 00000014`fee7ed40 00007ff9`2e53b4b0     Windows_UI_Xaml!CWindowRenderTarget::OnSuspend+0x46 [onecoreuap\windows\dxaml\xcp\core\compositor\windowrendertarget.cpp @ 394] 
23 00000014`fee7ed70 00007ff9`2e53b11f     Windows_UI_Xaml!CCoreServices::OnSuspend+0xd4 [onecoreuap\windows\dxaml\xcp\core\dll\xcpcore.cpp @ 7555] 
24 00000014`fee7edd0 00007ff9`2e42bacb     Windows_UI_Xaml!CCoreServices::OnBackgroundResourceTimeout+0x2f [onecoreuap\windows\dxaml\xcp\core\dll\xcpcore.cpp @ 10225] 
25 00000014`fee7ee00 00007ff9`2e152dd7     Windows_UI_Xaml!CControlBase::ScriptCallback+0xcb [onecoreuap\windows\dxaml\xcp\control\common\shared\controlbase.cpp @ 279] 
26 (Inline Function) --------`--------     Windows_UI_Xaml!CXcpDispatcher::OnScriptCallback+0x1eb [onecoreuap\windows\dxaml\xcp\win\shared\xcpwindow.cpp @ 1367] 
27 00000014`fee7ee80 00007ff9`2e15159e     Windows_UI_Xaml!CXcpDispatcher::OnWindowMessage+0x23f [onecoreuap\windows\dxaml\xcp\win\shared\xcpwindow.cpp @ 1121] 
28 (Inline Function) --------`--------     Windows_UI_Xaml!CXcpDispatcher::ProcessMessage+0x34 [onecoreuap\windows\dxaml\xcp\win\shared\xcpwindow.cpp @ 913] 
29 00000014`fee7efc0 00007ff9`2e4d9d86     Windows_UI_Xaml!CXcpDispatcher::WindowProc+0xce [onecoreuap\windows\dxaml\xcp\win\shared\xcpwindow.cpp @ 851] 
2a (Inline Function) --------`--------     Windows_UI_Xaml!CDeferredInvoke::DispatchQueuedMessage+0x67 [onecoreuap\windows\dxaml\xcp\win\shared\xcpwindow.cpp @ 292] 
2b (Inline Function) --------`--------     Windows_UI_Xaml!CXcpDispatcher::MessageTimerCallback+0x67 [onecoreuap\windows\dxaml\xcp\win\shared\xcpwindow.cpp @ 1563] 
2c 00000014`fee7f020 00007ff9`3e55430d     Windows_UI_Xaml!CXcpDispatcher::MessageTimerCallbackStatic+0x76 [onecoreuap\windows\dxaml\xcp\win\shared\xcpwindow.cpp @ 1555] 
2d 00000014`fee7f070 00007ff9`3e55356b     CoreMessaging!CFlat::SehSafe::Execute<<lambda_654db17c35df07198786f0867aa10de6> >+0x21
2e 00000014`fee7f0a0 00007ff9`3e5a3cc2     CoreMessaging!Microsoft::CoreUI::Dispatch::TimeoutHandler::ImportAdapter$+0x6b
2f 00000014`fee7f0e0 00007ff9`3e556fc4     CoreMessaging!Microsoft::CoreUI::Dispatch::TimeoutManager::Callback_OnDispatch+0x102
30 00000014`fee7f130 00007ff9`3e556b5d     CoreMessaging!Microsoft::CoreUI::Dispatch::Dispatcher::Callback_DispatchLoop+0x334
31 00000014`fee7f230 00007ff9`3e5652bd     CoreMessaging!Microsoft::CoreUI::Dispatch::EventLoop::Callback_RunCoreLoop+0x11d
32 00000014`fee7f2a0 00007ff9`3e56594d     CoreMessaging!Microsoft::CoreUI::Dispatch::UserAdapter::DrainCoreMessagingQueue+0x21d
33 00000014`fee7f320 00007ff9`3e5655e8     CoreMessaging!Microsoft::CoreUI::Dispatch::UserAdapter::OnUserDispatch+0x85
34 00000014`fee7f360 00007ff9`3e563f30     CoreMessaging!Microsoft::CoreUI::Dispatch::UserAdapter::DoWork+0x188
35 00000014`fee7f3d0 00007ff9`465c52a1     CoreMessaging!Microsoft::CoreUI::Dispatch::UserAdapter::WindowProc+0x40
36 00000014`fee7f440 00007ff9`465c4b3c     user32!UserCallWinProcCheckWow+0x341
37 00000014`fee7f5a0 00007ff9`465f65a3     user32!DispatchClientMessage+0x9c
38 00000014`fee7f600 00007ff9`476a37f4     user32!_fnDWORD+0x33
39 00000014`fee7f660 00007ff9`453512b4     ntdll!KiUserCallbackDispatcherContinue
3a 00000014`fee7f6e8 00007ff9`465b872f     win32u!NtUserPeekMessage+0x14
3b 00000014`fee7f6f0 00007ff9`465b86b8     user32!_PeekMessage+0x3f
3c 00000014`fee7f760 00007ff9`4561ed5b     user32!PeekMessageW+0x168
3d 00000014`fee7f7d0 00007ff9`4561df78     combase!ModernSTAWaitContext::PumpMessages+0xfb [onecore\com\combase\dcomrem\modernsta.cpp @ 2217] 
3e 00000014`fee7f840 00007ff9`456ec23c     combase!ModernSTAWaitContext::Wait+0xa50 [onecore\com\combase\dcomrem\modernsta.cpp @ 1360] 
3f 00000014`fee7faf0 00007ff9`456ec0aa     combase!ModernSTAWaitInNewContext+0xd4 [onecore\com\combase\dcomrem\modernsta.cpp @ 2728] 
40 00000014`fee7fbd0 00007ff9`456101b2     combase!ModernSTAThreadWaitForHandles+0x9a [onecore\com\combase\dcomrem\modernsta.cpp @ 2973] 
41 00000014`fee7fc50 00007ff8`e6f92bf6     combase!CoWaitForMultipleHandles+0xe2 [onecore\com\combase\dcomrem\sync.cxx @ 122] 
42 00000014`fee7fc90 00007ff8`e6f9278b     Windows_UI_XamlHost!ASTAThreadHost::ASTAThreadHostThreadProc+0xe6
43 00000014`fee7fd60 00007ff9`47457bea     Windows_UI_XamlHost!ASTAThreadHost::s_ASTAThreadHostThreadProc+0x2b
44 00000014`fee7fd90 00007ff9`453ae8d7     SHCORE!_WrapperThreadProc+0x15a
45 00000014`fee7fe90 00007ff9`475fbf2c     KERNEL32!BaseThreadInitThunk+0x17
46 00000014`fee7fec0 00000000`00000000     ntdll!RtlUserThreadStart+0x2c
16: kd> r r8
r8=0000000000000001
16: kd> !process
PROCESS ffffc8049f7020c0
    SessionId: 1  Cid: 2140    Peb: 14fe842000  ParentCid: 0860
    DirBase: 5f8cac000  ObjectTable: ffff8e0d54dd0580  HandleCount: 1330.
    Image: LogonUI.exe
    VadRoot ffffc8048b72ca20 Vads 312 Clone 0 Private 7142. Modified 62. Locked 306.
    DeviceMap ffff8e0d41291880
    Token                             ffff8e0d557a1770
    ElapsedTime                       00:02:30.221
    UserTime                          00:00:00.031
    KernelTime                        00:00:00.031
    QuotaPoolUsage[PagedPool]         670032
    QuotaPoolUsage[NonPagedPool]      44064
    Working Set Sizes (now,min,max)  (22063, 50, 345) (88252KB, 200KB, 1380KB)
    PeakWorkingSetSize                21814
    VirtualSize                       2101976 Mb
    PeakVirtualSize                   2101976 Mb
    PageFaultCount                    22379
    MemoryPriority                    BACKGROUND
    BasePriority                      13
    CommitCharge                      10921
    Job                               ffffc80497b3b0a0
```

```cpp
16: kd> g
Device object (ffffc804881c0030) is for:
  \Driver\amduw23g DriverObject ffffc8048b2ce280
Current Irp 00000000 RefCount 0 Type 00000023 Flags 00002004
SecurityDescriptor ffff8e0d49f67ea0 DevExt ffffc804881c0180 DevObjExt ffffc804881c1a80 
ExtensionFlags (0000000000)  
Characteristics (0x00000100)  FILE_DEVICE_SECURE_OPEN
AttachedTo (Lower) ffffc8047d9ecce0 \Driver\ACPI
Device queue is not busy.
PowerType:
1 ( DevicePowerState )
PowerState:
   +0x000 SystemState      : 1 ( PowerSystemWorking )
   +0x000 DeviceState      : 1 ( PowerDeviceD0 )
dxgkrnl!DpiDispatchPower:
fffff802`7b359020 48895c2418      mov     qword ptr [rsp+18h],rbx
17: kd> k
 # Child-SP          RetAddr               Call Site
00 fffffc07`f53bf4b8 fffff802`e939b24e     dxgkrnl!DpiDispatchPower [onecoreuap\windows\core\dxkernel\dxgkrnl\port\dpport.cxx @ 3223] 
01 fffffc07`f53bf4c0 fffff802`e945594a     nt!PopIrpWorker+0x2de [minkernel\ntos\po\irpwork.c @ 608] 
02 fffffc07`f53bf570 fffff802`e967a004     nt!PspSystemThreadStartup+0x5a [minkernel\ntos\ps\psexec.c @ 11931] 
03 fffffc07`f53bf5c0 00000000`00000000     nt!KiStartSystemThread+0x34 [minkernel\ntos\ke\amd64\threadbg.asm @ 87] 
```

### 4. D3 for GFX

```cpp
17: kd> g
nt!PoRequestPowerIrp:
fffff802`e939d550 4883ec48        sub     rsp,48h
14: kd> k
 # Child-SP          RetAddr               Call Site
00 fffffc07`ede27128 fffff802`7afd247e     nt!PoRequestPowerIrp [minkernel\ntos\po\pocall.c @ 124] 
01 fffffc07`ede27130 fffff802`7afd20bc     dxgkrnl!DpiRequestDevicePowerIrp+0xe6 [onecoreuap\windows\core\dxkernel\dxgkrnl\port\dpshared.cxx @ 4462] 
02 fffffc07`ede27170 fffff802`7afd1be9     dxgkrnl!DpiRequestDevicePowerState+0x3d4 [onecoreuap\windows\core\dxkernel\dxgkrnl\port\dpshared.cxx @ 5009] 
03 (Inline Function) --------`--------     dxgkrnl!DXGADAPTER::PowerRuntimeDevicePowerRequiredCallback+0x1e [onecoreuap\windows\core\dxkernel\dxgkrnl\core\adapter.cxx @ 1275] 
04 fffffc07`ede27200 fffff802`e92f39d3     dxgkrnl!DxgkPowerRuntimeDevicePowerNotRequiredCallback+0x39 [onecoreuap\windows\core\dxkernel\dxgkrnl\core\adapterpublic.cxx @ 180] 
05 fffffc07`ede27240 fffff802`e92fe847     nt!PopFxProcessWork+0x863 [minkernel\ntos\po\runtime.c @ 9476] 
06 fffffc07`ede27350 fffff802`e92fe5ab     nt!PopFxDispatchPluginWorkOnce+0x22b [minkernel\ntos\po\runtime.c @ 19818] 
07 fffffc07`ede274d0 fffff802`e95932e4     nt!PopFxProcessWorkPool+0x13b [minkernel\ntos\po\runtime.c @ 9913] 
08 fffffc07`ede27540 fffff802`e945594a     nt!PopFxStaticWorkPoolThread+0x44 [minkernel\ntos\po\runtime.c @ 8747] 
09 fffffc07`ede27570 fffff802`e967a004     nt!PspSystemThreadStartup+0x5a [minkernel\ntos\ps\psexec.c @ 11931] 
0a fffffc07`ede275c0 00000000`00000000     nt!KiStartSystemThread+0x34 [minkernel\ntos\ke\amd64\threadbg.asm @ 87] 
14: kd> r r8
r8=0000000000000004
```

```cpp
14: kd> g
Device object (ffffc804881c0030) is for:
  \Driver\amduw23g DriverObject ffffc8048b2ce280
Current Irp 00000000 RefCount 0 Type 00000023 Flags 00002004
SecurityDescriptor ffff8e0d49f67ea0 DevExt ffffc804881c0180 DevObjExt ffffc804881c1a80 
ExtensionFlags (0000000000)  
Characteristics (0x00000100)  FILE_DEVICE_SECURE_OPEN
AttachedTo (Lower) ffffc8047d9ecce0 \Driver\ACPI
Device queue is not busy.
PowerType:
1 ( DevicePowerState )
PowerState:
   +0x000 SystemState      : 4 ( PowerSystemSleeping3 )
   +0x000 DeviceState      : 4 ( PowerDeviceD3 )
dxgkrnl!DpiDispatchPower:
fffff802`7b359020 48895c2418      mov     qword ptr [rsp+18h],rbx
17: kd> k
 # Child-SP          RetAddr               Call Site
00 fffffc07`f53bf4b8 fffff802`e939b24e     dxgkrnl!DpiDispatchPower [onecoreuap\windows\core\dxkernel\dxgkrnl\port\dpport.cxx @ 3223] 
01 fffffc07`f53bf4c0 fffff802`e945594a     nt!PopIrpWorker+0x2de [minkernel\ntos\po\irpwork.c @ 608] 
02 fffffc07`f53bf570 fffff802`e967a004     nt!PspSystemThreadStartup+0x5a [minkernel\ntos\ps\psexec.c @ 11931] 
03 fffffc07`f53bf5c0 00000000`00000000     nt!KiStartSystemThread+0x34 [minkernel\ntos\ke\amd64\threadbg.asm @ 87] 
```

### 🎉 Sleep